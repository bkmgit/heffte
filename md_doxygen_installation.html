<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Highly Efficient FFT for Exascale: HeFFTe v2.3: Installation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="heffte.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Highly Efficient FFT for Exascale: HeFFTe v2.3
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_doxygen_installation.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Installation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><ul><li class="level2"><a href="#autotoc_md8">Requirements</a></li>
<li class="level2"><a href="#autotoc_md9">CMake Installation</a></li>
<li class="level2"><a href="#autotoc_md10">List of Available Backend Libraries</a></li>
<li class="level2"><a href="#autotoc_md11">GPU-Aware MPI</a></li>
<li class="level2"><a href="#autotoc_md12">Linking to HeFFTe</a></li>
<li class="level2"><a href="#autotoc_md13">GNU Make Installation</a></li>
<li class="level2"><a href="#autotoc_md14">Known Issues</a></li>
</ul>
</ul>
</div>
<div class="textblock"><h2><a class="anchor" id="autotoc_md8"></a>
Requirements</h2>
<p>At the minimum, heFFTe requires a C++11 capable compiler, an implementation of the Message Passing Library (MPI), and at least one backend FFT library. The heFFTe library can be build with either CMake 3.10 or newer, or a simple GNU Make build engine. CMake is the recommended way to use heFFTe since dependencies and options are much easier to export to user projects and not all options could be cleanly implemented in the rigid Makefile.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Compiler   </th><th class="markdownTableHeadNone">Tested versions    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">gcc   </td><td class="markdownTableBodyNone">7 - 11    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">clang   </td><td class="markdownTableBodyNone">5 - 14    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">icc   </td><td class="markdownTableBodyNone">18    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">dpcpp   </td><td class="markdownTableBodyNone">2021.2    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">OpenMPI   </td><td class="markdownTableBodyNone">4.0.3   </td></tr>
</table>
<p>Tested backend libraries:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Backend   </th><th class="markdownTableHeadNone">Tested versions    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">stock   </td><td class="markdownTableBodyNone">all    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">fftw3   </td><td class="markdownTableBodyNone">3.3.7 - 3.3.10    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">mkl   </td><td class="markdownTableBodyNone">2016    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">oneapi/onemkl   </td><td class="markdownTableBodyNone">2021.4    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">cuda/cufft   </td><td class="markdownTableBodyNone">10 - 11    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">rocm/rocfft   </td><td class="markdownTableBodyNone">4.0 - 5.6   </td></tr>
</table>
<p>The listed tested versions are part of the continuous integration and nightly build systems, but heFFTe may yet work with other compilers and backend versions.</p>
<h2><a class="anchor" id="autotoc_md9"></a>
CMake Installation</h2>
<p>Typical CMake build follows the steps: </p><div class="fragment"><div class="line">mkdir build</div>
<div class="line">cd build</div>
<div class="line">cmake &lt;cmake-build-command-options&gt; &lt;path-to-heffte-source&gt;</div>
<div class="line">make</div>
<div class="line">make install</div>
<div class="line">make test_install</div>
</div><!-- fragment --><p>Typical CMake build command: </p><div class="fragment"><div class="line">cmake \</div>
<div class="line">    -D CMAKE_BUILD_TYPE=Release \</div>
<div class="line">    -D BUILD_SHARED_LIBS=ON     \</div>
<div class="line">    -D CMAKE_INSTALL_PREFIX=&lt;path-for-installation&gt; \</div>
<div class="line">    -D Heffte_ENABLE_AVX=ON \</div>
<div class="line">    -D Heffte_ENABLE_FFTW=ON \</div>
<div class="line">    -D FFTW_ROOT=&lt;path-to-fftw3-installation&gt; \</div>
<div class="line">    -D Heffte_ENABLE_CUDA=ON \</div>
<div class="line">    -D CUDA_TOOLKIT_ROOT_DIR=&lt;path-to-cuda-installation&gt; \</div>
<div class="line">    &lt;path-to-heffte-source-code&gt;</div>
</div><!-- fragment --><p>The standard CMake options are also accepted: </p><div class="fragment"><div class="line">CMAKE_CXX_COMPILER=&lt;path-to-suitable-cxx-compiler&gt;        (sets the C++ compiler)</div>
<div class="line">CMAKE_CXX_FLAGS=&quot;&lt;additional cxx flags&gt;&quot;                  (adds flags to the build process)</div>
<div class="line">MPI_CXX_COMPILER=&lt;path-to-suitable-mpi-compiler-wrapper&gt;  (specifies the MPI compiler wrapper)</div>
</div><!-- fragment --><p>Additional heFFTe options: </p><div class="fragment"><div class="line">Heffte_ENABLE_ROCM=&lt;ON/OFF&gt;      (enable the rocFFT backend)</div>
<div class="line">Heffte_ENABLE_ONEAPI=&lt;ON/OFF&gt;    (enable the oneMKL backend)</div>
<div class="line">Heffte_ENABLE_MKL=&lt;ON/OFF&gt;       (enable the MKL backend)</div>
<div class="line">Heffte_ENABLE_AVX512=&lt;ON/OFF&gt;    (enable AVX512 instructions in the stock backend)</div>
<div class="line">MKL_ROOT=&lt;path&gt;                  (path to the MKL folder)</div>
<div class="line">Heffte_ENABLE_DOXYGEN=&lt;ON/OFF&gt;   (build the documentation)</div>
<div class="line">Heffte_ENABLE_TRACING=&lt;ON/OFF&gt;   (enable the even logging engine)</div>
</div><!-- fragment --><p>Additional language interfaces and helper methods: </p><div class="fragment"><div class="line">-D Heffte_ENABLE_PYTHON=&lt;ON/OFF&gt;   (configure the Python module)</div>
<div class="line">-D Heffte_ENABLE_FORTRAN=&lt;ON/OFF&gt;  (build the Fortran modules)</div>
<div class="line">-D Heffte_ENABLE_SWIG=&lt;ON/OFF&gt;     (generate new Fortrans source files)</div>
<div class="line">-D Heffte_ENABLE_MAGMA=&lt;ON/OFF&gt;    (link to MAGMA for helper methods)</div>
</div><!-- fragment --><p> See the Fortran and Python sections for details.</p>
<h2><a class="anchor" id="autotoc_md10"></a>
List of Available Backend Libraries</h2>
<ul>
<li><b>Stock:</b> the stock backend library is a CPU-based 1-D FFT library built <em>into</em> HeFFTe, and requires no additional external libraries or hardware. This is enabled by default, and can optionally perform vectorized complex arithmetic using AVX and AVX512 instruction sets (this accelerates the backend by up to an order of magnitude, but includes no vectorization by default). This vectorization is enabled with <div class="fragment"><div class="line">-D Heffte_ENABLE_AVX=&lt;ON/OFF&gt;</div>
<div class="line">-D Heffte_ENABLE_AVX512=&lt;ON/OFF&gt;</div>
</div><!-- fragment --> Just using <code>Heffte_ENABLE_AVX512</code> enables all the vectorization flags. Using vectorization is optional and not required for using the stock backend.</li>
<li><b>FFTW3:</b> the <a href="http://www.fftw.org/">fftw3</a> library is the de-facto standard for open source FFT library and is distributed under the GNU General Public License, the fftw3 backend is enabled with: <div class="fragment"><div class="line">-D Heffte_ENABLE_FFTW=ON</div>
<div class="line">-D FFTW_ROOT=&lt;path-to-fftw3-installation&gt;</div>
</div><!-- fragment --> Note that fftw3 uses two different libraries for single and double precision, while HeFFTe handles all precisions in a single template library; thus both the fftw3 (double-precision) and fftw3f (single-precision) variants are needed and those can be installed in the same path.</li>
<li><b>MKL:</b> the <a href="https://software.intel.com/content/www/us/en/develop/tools/math-kernel-library.html">Intel Math Kernel Library</a> provides optimized FFT implementation targeting Intel processors and can be enabled within heFFTe with: <div class="fragment"><div class="line">-D Heffte_ENABLE_MKL=ON</div>
<div class="line">-D MKL_ROOT=&lt;path-to-mkl-installation&gt;</div>
</div><!-- fragment --> The <code>MKL_ROOT</code> default to the environment variable <code>MKLROOT</code> (chosen by Intel). The additional variable <code>Heffte_MKL_THREAD_LIBS</code> allows to choose the MKL threaded backend, tested with <code>mkl_gnu_thread</code> and <code>mkl_intel_thread</code>, the default is to use GNU-threads on GCC compiler and Intel otherwise. Note that <code>mkl_intel_thread</code> also requires <code>libiomp5.so</code> and heFFTe will search for it in the system paths and <code>LD_LIBRARY_PATH</code>, unless the variable <code>Heffte_MKL_IOMP5</code> is defined and pointing to <code>libiomp5.so</code>. GNU-threads do not use <code>libiomp5.so</code> but the GNU <code>libgomp.so</code> which CMake finds automatically.</li>
<li><b>oneMKL</b> the <a href="https://spec.oneapi.com/versions/latest/elements/oneMKL/source/index.html">Intel oneMKL Library</a> provides optimized FFT implementation targeting Intel GPUs and can be enabled within heFFTe with: <div class="fragment"><div class="line">-D CMAKE_CXX_COMPILER=dpcpp</div>
<div class="line">-D Heffte_ENABLE_ONEAPI=ON</div>
<div class="line">-D Heffte_ONEMKL_ROOT=&lt;path-to-onemkl-installation&gt;</div>
</div><!-- fragment --> The <code>Heffte_ONEMKL_ROOT</code> defaults to the environment variable <code>ONEAPI_ROOT</code>. The Intel oneAPI framework provides support for both CPU and GPU devices from the same code-base, thus the oneMKL libraries require the CPU MKL libraries and the MKL options will be enabled automatically if oneMKL is selected.</li>
<li><b>CUFFT:</b> the <a href="https://developer.nvidia.com/cuda-zone">Nvidia CUDA framework</a> provides a GPU accelerated FFT library <a href="https://docs.nvidia.com/cuda/cufft/index.html">cuFFT</a>, which can be enabled in heFFTe with: <div class="fragment"><div class="line">-D Heffte_ENABLE_CUDA=ON</div>
<div class="line">-D CUDA_TOOLKIT_ROOT_DIR=&lt;path-to-cuda-installation&gt;</div>
</div><!-- fragment --></li>
<li><b>ROCFFT:</b> the <a href="https://github.com/RadeonOpenCompute/ROCm">AMD ROCm framework</a> provides a GPU accelerated FFT library <a href="https://github.com/ROCmSoftwarePlatform/rocFFT">rocFFT</a>, which can be enabled in heFFTe with: <div class="fragment"><div class="line">-D CMAKE_CXX_COMPILER=hipcc</div>
<div class="line">-D Heffte_ENABLE_ROCM=ON</div>
</div><!-- fragment --></li>
</ul>
<p><b>Note:</b> Only one of the GPU backends can be enabled (CUDA, ROCM, or ONEAPI) since the three backends operate with arrays allocated in GPU device memory (or alternatively shared/managed memory). By default when using either GPU backend, heFFTe assumes that the MPI implementation is GPU-Aware, see the next section.</p>
<h2><a class="anchor" id="autotoc_md11"></a>
GPU-Aware MPI</h2>
<p>Different implementations of MPI can provide GPU-Aware capabilities, where data can be send/received directly in GPU memory. OpenMPI provided CUDA aware capabilities if compiled with the corresponding options, e.g., see <a href="https://www.open-mpi.org/faq/?category=buildcuda">CUDA-Aware OpenMPI</a>. Both CUDA and ROCm support such API; however, the specific implementation available to the user may not be available for various reasons, e.g., insufficient hardware support. HeFFTe can be compiled without GPU-Aware capabilities with the CMake option: </p><div class="fragment"><div class="line">-D Heffte_DISABLE_GPU_AWARE_MPI=ON</div>
</div><!-- fragment --><p> <b>Note:</b> The GPU-Aware capabilities can also be disabled at runtime by setting the corresponding option in <code><a class="el" href="structheffte_1_1plan__options.html" title="Defines a set of tweaks and options to use in the plan generation.">heffte::plan_options</a></code>. On some platforms, the GPU-Aware MPI calls have significantly larger latency and moving the buffers to the CPU before ini</p>
<h2><a class="anchor" id="autotoc_md12"></a>
Linking to HeFFTe</h2>
<p>HeFFTe installs a CMake package-config file in </p><div class="fragment"><div class="line">&lt;install-prefix&gt;/lib/cmake/</div>
</div><!-- fragment --><p> Typical project linking to HeFFTe will look like this: </p><div class="fragment"><div class="line">project(heffte_user VERSION 1.0 LANGUAGES CXX)</div>
<div class="line"> </div>
<div class="line">find_package(Heffte PATHS &lt;install-prefix&gt;)</div>
<div class="line"> </div>
<div class="line">add_executable(foo ...)</div>
<div class="line">target_link_libraries(foo Heffte::Heffte)</div>
</div><!-- fragment --><p> An example is installed in <code>&lt;install-prefix&gt;/share/heffte/examples/</code>.</p>
<p>The package-config also provides a set of components corresponding to the different compile options, specifically: </p><div class="fragment"><div class="line">FFTW MKL CUDA ROCM ONEAPI PYTHON Fortran GPUAWARE</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md13"></a>
GNU Make Installation</h2>
<p>HeFFTe supports a GNU Make build engine, where dependencies and compilers are set manually in the included Makefile. Selecting the backends is done with: </p><div class="fragment"><div class="line">make backends=fftw,cufft</div>
</div><!-- fragment --><p> The <code>backends</code> should be separated by commas and must have correctly selected compilers, includes, and libraries. Additional options are available, see </p><div class="fragment"><div class="line">make help</div>
</div><!-- fragment --><p> and see also the comments inside the Makefile.</p>
<p>Testing is invoked with: </p><div class="fragment"><div class="line">make ctest</div>
</div><!-- fragment --><p> The library will be build in <code>./lib/</code></p>
<p>The GNU Make build engine does not support all options, e.g., MAGMA or disabling the GPU-Aware calls, but is provided for testing and debugging purposes.</p>
<h2><a class="anchor" id="autotoc_md14"></a>
Known Issues</h2>
<ul>
<li>the current testing suite requires about 3GB of free GPU RAM<ul>
<li>CUDA seem to reserve 100-200MB of RAM per MPI rank and some tests use 12 ranks</li>
<li>the GPU handles used by MAGMA-CUDA and MAGMA-HIP are not destroyed on time (both backends seem to implement some garbage collection mechanism), thus even an 8GB GPU may run out of memory when using the 12 rank test </li>
</ul>
</li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
