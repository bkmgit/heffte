<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Highly Efficient FFT for Exascale: HeFFTe v2.3: include/heffte_geometry.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="heffte.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Highly Efficient FFT for Exascale: HeFFTe v2.3
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('heffte__geometry_8h_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">heffte_geometry.h</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">    -- heFFTe --</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">       Univ. of Tennessee, Knoxville</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">       @date</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160; </div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#ifndef HEFFTE_GEOMETRY_H</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#define HEFFTE_GEOMETRY_H</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160; </div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &lt;array&gt;</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &lt;valarray&gt;</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &quot;heffte_utils.h&quot;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160; </div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespaceheffte.html">heffte</a> {</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160; </div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">typename</span> index = <span class="keywordtype">int</span>&gt;</div>
<div class="line"><a name="l00067"></a><span class="lineno"><a class="line" href="structheffte_1_1box3d.html">   67</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structheffte_1_1box3d.html">box3d</a>{</div>
<div class="line"><a name="l00069"></a><span class="lineno"><a class="line" href="structheffte_1_1box3d.html#a1792ae4c8a043b87aa2733fb7255169a">   69</a></span>&#160;    <a class="code" href="structheffte_1_1box3d.html#a1792ae4c8a043b87aa2733fb7255169a">box3d</a>(std::array&lt;index, 3&gt; clow, std::array&lt;index, 3&gt; chigh) :</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        <a class="code" href="structheffte_1_1box3d.html#aaa4abcee136213388df9ae363e33c8c8">low</a>(clow), <a class="code" href="structheffte_1_1box3d.html#ab86bc20cf1eaba6c4b9b2dcb63033185">high</a>(chigh), <a class="code" href="structheffte_1_1box3d.html#a76aea01f1090189c317cfb56ef2e996c">size</a>({<a class="code" href="structheffte_1_1box3d.html#ab86bc20cf1eaba6c4b9b2dcb63033185">high</a>[0] - <a class="code" href="structheffte_1_1box3d.html#aaa4abcee136213388df9ae363e33c8c8">low</a>[0] + 1, <a class="code" href="structheffte_1_1box3d.html#ab86bc20cf1eaba6c4b9b2dcb63033185">high</a>[1] - <a class="code" href="structheffte_1_1box3d.html#aaa4abcee136213388df9ae363e33c8c8">low</a>[1] + 1, <a class="code" href="structheffte_1_1box3d.html#ab86bc20cf1eaba6c4b9b2dcb63033185">high</a>[2] - <a class="code" href="structheffte_1_1box3d.html#aaa4abcee136213388df9ae363e33c8c8">low</a>[2] + 1}), <a class="code" href="structheffte_1_1box3d.html#ad5476621fa6cd5053bfe7b33a864f34d">order</a>({0, 1, 2})</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    {}</div>
<div class="line"><a name="l00073"></a><span class="lineno"><a class="line" href="structheffte_1_1box3d.html#a6eadc38edc43ae83707d3d5e1ccfdb36">   73</a></span>&#160;    <a class="code" href="structheffte_1_1box3d.html#a6eadc38edc43ae83707d3d5e1ccfdb36">box3d</a>(std::array&lt;index, 3&gt; clow, std::array&lt;index, 3&gt; chigh, std::array&lt;int, 3&gt; corder) :</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        <a class="code" href="structheffte_1_1box3d.html#aaa4abcee136213388df9ae363e33c8c8">low</a>(clow), <a class="code" href="structheffte_1_1box3d.html#ab86bc20cf1eaba6c4b9b2dcb63033185">high</a>(chigh), <a class="code" href="structheffte_1_1box3d.html#a76aea01f1090189c317cfb56ef2e996c">size</a>({<a class="code" href="structheffte_1_1box3d.html#ab86bc20cf1eaba6c4b9b2dcb63033185">high</a>[0] - <a class="code" href="structheffte_1_1box3d.html#aaa4abcee136213388df9ae363e33c8c8">low</a>[0] + 1, <a class="code" href="structheffte_1_1box3d.html#ab86bc20cf1eaba6c4b9b2dcb63033185">high</a>[1] - <a class="code" href="structheffte_1_1box3d.html#aaa4abcee136213388df9ae363e33c8c8">low</a>[1] + 1, <a class="code" href="structheffte_1_1box3d.html#ab86bc20cf1eaba6c4b9b2dcb63033185">high</a>[2] - <a class="code" href="structheffte_1_1box3d.html#aaa4abcee136213388df9ae363e33c8c8">low</a>[2] + 1}), <a class="code" href="structheffte_1_1box3d.html#ad5476621fa6cd5053bfe7b33a864f34d">order</a>(corder)</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    {}</div>
<div class="line"><a name="l00077"></a><span class="lineno"><a class="line" href="structheffte_1_1box3d.html#aad3f4b43abbf7aeec4c4c9fd2dbe66e2">   77</a></span>&#160;    <a class="code" href="structheffte_1_1box3d.html#aad3f4b43abbf7aeec4c4c9fd2dbe66e2">box3d</a>(std::array&lt;index, 2&gt; clow, std::array&lt;index, 2&gt; chigh) :</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        <a class="code" href="structheffte_1_1box3d.html">box3d</a>(std::array&lt;index, 3&gt;{clow[0], clow[1], 0}, std::array&lt;index, 3&gt;{chigh[0], chigh[1], 0}){}</div>
<div class="line"><a name="l00080"></a><span class="lineno"><a class="line" href="structheffte_1_1box3d.html#abbd22d4cc74afc74d83fa67bd5ecf2d9">   80</a></span>&#160;    <a class="code" href="structheffte_1_1box3d.html#abbd22d4cc74afc74d83fa67bd5ecf2d9">box3d</a>(std::array&lt;index, 2&gt; clow, std::array&lt;index, 2&gt; chigh, std::array&lt;int, 2&gt; corder) :</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        <a class="code" href="structheffte_1_1box3d.html">box3d</a>(std::array&lt;index, 3&gt;{clow[0], clow[1], 0}, std::array&lt;index, 3&gt;{chigh[0], chigh[1], 0},</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;              std::array&lt;index, 3&gt;{corder[0], corder[1], 2}){}</div>
<div class="line"><a name="l00084"></a><span class="lineno"><a class="line" href="structheffte_1_1box3d.html#a386faaf6108f321eca5a334557336615">   84</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="structheffte_1_1box3d.html#a386faaf6108f321eca5a334557336615">empty</a>()<span class="keyword"> const</span>{ <span class="keywordflow">return</span> (<a class="code" href="structheffte_1_1box3d.html#a76aea01f1090189c317cfb56ef2e996c">size</a>[0] &lt;= 0 or <a class="code" href="structheffte_1_1box3d.html#a76aea01f1090189c317cfb56ef2e996c">size</a>[1] &lt;= 0 or <a class="code" href="structheffte_1_1box3d.html#a76aea01f1090189c317cfb56ef2e996c">size</a>[2] &lt;= 0); }</div>
<div class="line"><a name="l00086"></a><span class="lineno"><a class="line" href="structheffte_1_1box3d.html#a8bce7ff43ff4483ccfd80c372bb819a6">   86</a></span>&#160;    <span class="keywordtype">long</span> <span class="keywordtype">long</span> <a class="code" href="structheffte_1_1box3d.html#a8bce7ff43ff4483ccfd80c372bb819a6">count</a>()<span class="keyword"> const</span>{ <span class="keywordflow">return</span> (<a class="code" href="structheffte_1_1box3d.html#a386faaf6108f321eca5a334557336615">empty</a>()) ? 0 :</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        (<span class="keyword">static_cast&lt;</span><span class="keywordtype">long</span> <span class="keywordtype">long</span><span class="keyword">&gt;</span>(<a class="code" href="structheffte_1_1box3d.html#a76aea01f1090189c317cfb56ef2e996c">size</a>[0]) * <span class="keyword">static_cast&lt;</span><span class="keywordtype">long</span> <span class="keywordtype">long</span><span class="keyword">&gt;</span>(<a class="code" href="structheffte_1_1box3d.html#a76aea01f1090189c317cfb56ef2e996c">size</a>[1]) * <span class="keyword">static_cast&lt;</span><span class="keywordtype">long</span> <span class="keywordtype">long</span><span class="keyword">&gt;</span>(<a class="code" href="structheffte_1_1box3d.html#a76aea01f1090189c317cfb56ef2e996c">size</a>[2])); }</div>
<div class="line"><a name="l00089"></a><span class="lineno"><a class="line" href="structheffte_1_1box3d.html#a1c44f9e9fa3b33de47f9d8708e01e331">   89</a></span>&#160;    <a class="code" href="structheffte_1_1box3d.html">box3d</a> <a class="code" href="structheffte_1_1box3d.html#a1c44f9e9fa3b33de47f9d8708e01e331">collide</a>(<a class="code" href="structheffte_1_1box3d.html">box3d</a> <span class="keyword">const</span> other)<span class="keyword"> const</span>{</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="structheffte_1_1box3d.html#a386faaf6108f321eca5a334557336615">empty</a>() or other.<a class="code" href="structheffte_1_1box3d.html#a386faaf6108f321eca5a334557336615">empty</a>()) <span class="keywordflow">return</span> <a class="code" href="structheffte_1_1box3d.html#a1792ae4c8a043b87aa2733fb7255169a">box3d</a>({0, 0, 0}, {-1, -1, -1});</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="structheffte_1_1box3d.html#a1792ae4c8a043b87aa2733fb7255169a">box3d</a>({std::max(<a class="code" href="structheffte_1_1box3d.html#aaa4abcee136213388df9ae363e33c8c8">low</a>[0], other.<a class="code" href="structheffte_1_1box3d.html#aaa4abcee136213388df9ae363e33c8c8">low</a>[0]), std::max(<a class="code" href="structheffte_1_1box3d.html#aaa4abcee136213388df9ae363e33c8c8">low</a>[1], other.<a class="code" href="structheffte_1_1box3d.html#aaa4abcee136213388df9ae363e33c8c8">low</a>[1]), std::max(<a class="code" href="structheffte_1_1box3d.html#aaa4abcee136213388df9ae363e33c8c8">low</a>[2], other.<a class="code" href="structheffte_1_1box3d.html#aaa4abcee136213388df9ae363e33c8c8">low</a>[2])},</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;                     {std::min(<a class="code" href="structheffte_1_1box3d.html#ab86bc20cf1eaba6c4b9b2dcb63033185">high</a>[0], other.<a class="code" href="structheffte_1_1box3d.html#ab86bc20cf1eaba6c4b9b2dcb63033185">high</a>[0]), std::min(<a class="code" href="structheffte_1_1box3d.html#ab86bc20cf1eaba6c4b9b2dcb63033185">high</a>[1], other.<a class="code" href="structheffte_1_1box3d.html#ab86bc20cf1eaba6c4b9b2dcb63033185">high</a>[1]), std::min(<a class="code" href="structheffte_1_1box3d.html#ab86bc20cf1eaba6c4b9b2dcb63033185">high</a>[2], other.<a class="code" href="structheffte_1_1box3d.html#ab86bc20cf1eaba6c4b9b2dcb63033185">high</a>[2])}, <a class="code" href="structheffte_1_1box3d.html#ad5476621fa6cd5053bfe7b33a864f34d">order</a>);</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    }</div>
<div class="line"><a name="l00095"></a><span class="lineno"><a class="line" href="structheffte_1_1box3d.html#a834afa9d585eaaa047e656ca7dc5db2e">   95</a></span>&#160;    <a class="code" href="structheffte_1_1box3d.html">box3d</a> <a class="code" href="structheffte_1_1box3d.html#a834afa9d585eaaa047e656ca7dc5db2e">r2c</a>(<span class="keywordtype">int</span> dimension)<span class="keyword"> const</span>{</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="structheffte_1_1box3d.html#a386faaf6108f321eca5a334557336615">empty</a>()) <span class="keywordflow">return</span> <a class="code" href="structheffte_1_1box3d.html#a1792ae4c8a043b87aa2733fb7255169a">box3d</a>({0, 0, 0}, {-1, -1, -1});</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        <span class="keywordflow">switch</span>(dimension){</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;            <span class="keywordflow">case</span> 0: <span class="keywordflow">return</span> <a class="code" href="structheffte_1_1box3d.html#a1792ae4c8a043b87aa2733fb7255169a">box3d</a>(<a class="code" href="structheffte_1_1box3d.html#aaa4abcee136213388df9ae363e33c8c8">low</a>, {<a class="code" href="structheffte_1_1box3d.html#aaa4abcee136213388df9ae363e33c8c8">low</a>[0] + <a class="code" href="structheffte_1_1box3d.html#a76aea01f1090189c317cfb56ef2e996c">size</a>[0] / 2, <a class="code" href="structheffte_1_1box3d.html#ab86bc20cf1eaba6c4b9b2dcb63033185">high</a>[1], <a class="code" href="structheffte_1_1box3d.html#ab86bc20cf1eaba6c4b9b2dcb63033185">high</a>[2]}, <a class="code" href="structheffte_1_1box3d.html#ad5476621fa6cd5053bfe7b33a864f34d">order</a>);</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;            <span class="keywordflow">case</span> 1: <span class="keywordflow">return</span> <a class="code" href="structheffte_1_1box3d.html#a1792ae4c8a043b87aa2733fb7255169a">box3d</a>(<a class="code" href="structheffte_1_1box3d.html#aaa4abcee136213388df9ae363e33c8c8">low</a>, {<a class="code" href="structheffte_1_1box3d.html#ab86bc20cf1eaba6c4b9b2dcb63033185">high</a>[0], <a class="code" href="structheffte_1_1box3d.html#aaa4abcee136213388df9ae363e33c8c8">low</a>[1] + <a class="code" href="structheffte_1_1box3d.html#a76aea01f1090189c317cfb56ef2e996c">size</a>[1] / 2, <a class="code" href="structheffte_1_1box3d.html#ab86bc20cf1eaba6c4b9b2dcb63033185">high</a>[2]}, <a class="code" href="structheffte_1_1box3d.html#ad5476621fa6cd5053bfe7b33a864f34d">order</a>);</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;            <span class="keywordflow">default</span>: <span class="comment">// dimension == 2</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="structheffte_1_1box3d.html#a1792ae4c8a043b87aa2733fb7255169a">box3d</a>(<a class="code" href="structheffte_1_1box3d.html#aaa4abcee136213388df9ae363e33c8c8">low</a>, {<a class="code" href="structheffte_1_1box3d.html#ab86bc20cf1eaba6c4b9b2dcb63033185">high</a>[0], <a class="code" href="structheffte_1_1box3d.html#ab86bc20cf1eaba6c4b9b2dcb63033185">high</a>[1], <a class="code" href="structheffte_1_1box3d.html#aaa4abcee136213388df9ae363e33c8c8">low</a>[2] + <a class="code" href="structheffte_1_1box3d.html#a76aea01f1090189c317cfb56ef2e996c">size</a>[2] / 2}, <a class="code" href="structheffte_1_1box3d.html#ad5476621fa6cd5053bfe7b33a864f34d">order</a>);</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        }</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    }</div>
<div class="line"><a name="l00105"></a><span class="lineno"><a class="line" href="structheffte_1_1box3d.html#a6907e43e02b4c4be3402c762581120ce">  105</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="structheffte_1_1box3d.html#a6907e43e02b4c4be3402c762581120ce">is2d</a>()<span class="keyword"> const</span>{ <span class="keywordflow">return</span> (<a class="code" href="structheffte_1_1box3d.html#a76aea01f1090189c317cfb56ef2e996c">size</a>[0] == 1 or <a class="code" href="structheffte_1_1box3d.html#a76aea01f1090189c317cfb56ef2e996c">size</a>[1] == 1 or <a class="code" href="structheffte_1_1box3d.html#a76aea01f1090189c317cfb56ef2e996c">size</a>[2] == 1); }</div>
<div class="line"><a name="l00107"></a><span class="lineno"><a class="line" href="structheffte_1_1box3d.html#a310cb34db143812c3a1b78000658ee8f">  107</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="structheffte_1_1box3d.html#a310cb34db143812c3a1b78000658ee8f">operator == </a>(<a class="code" href="structheffte_1_1box3d.html">box3d</a> <span class="keyword">const</span> &amp;other)<span class="keyword"> const</span>{</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        <span class="keywordflow">return</span> not (*<span class="keyword">this</span> != other);</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    }</div>
<div class="line"><a name="l00111"></a><span class="lineno"><a class="line" href="structheffte_1_1box3d.html#a2b6ec65b21f44a849d3655bb2670216a">  111</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="structheffte_1_1box3d.html#a2b6ec65b21f44a849d3655bb2670216a">operator != </a>(<a class="code" href="structheffte_1_1box3d.html">box3d</a> <span class="keyword">const</span> &amp;other)<span class="keyword"> const</span>{</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;3; i++)</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="structheffte_1_1box3d.html#aaa4abcee136213388df9ae363e33c8c8">low</a>[i] != other.<a class="code" href="structheffte_1_1box3d.html#aaa4abcee136213388df9ae363e33c8c8">low</a>[i] or <a class="code" href="structheffte_1_1box3d.html#ab86bc20cf1eaba6c4b9b2dcb63033185">high</a>[i] != other.<a class="code" href="structheffte_1_1box3d.html#ab86bc20cf1eaba6c4b9b2dcb63033185">high</a>[i]) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    }</div>
<div class="line"><a name="l00117"></a><span class="lineno"><a class="line" href="structheffte_1_1box3d.html#aa50094796d7640f39fc1663053baef2b">  117</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="structheffte_1_1box3d.html#aa50094796d7640f39fc1663053baef2b">ordered_same_as</a>(<a class="code" href="structheffte_1_1box3d.html">box3d</a> <span class="keyword">const</span> &amp;other)<span class="keyword"> const</span>{</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        <span class="keywordflow">return</span> (<a class="code" href="structheffte_1_1box3d.html#ad5476621fa6cd5053bfe7b33a864f34d">order</a>[0] == other.<a class="code" href="structheffte_1_1box3d.html#ad5476621fa6cd5053bfe7b33a864f34d">order</a>[0]) and (<a class="code" href="structheffte_1_1box3d.html#ad5476621fa6cd5053bfe7b33a864f34d">order</a>[1] == other.<a class="code" href="structheffte_1_1box3d.html#ad5476621fa6cd5053bfe7b33a864f34d">order</a>[1]) and (<a class="code" href="structheffte_1_1box3d.html#ad5476621fa6cd5053bfe7b33a864f34d">order</a>[2] == other.<a class="code" href="structheffte_1_1box3d.html#ad5476621fa6cd5053bfe7b33a864f34d">order</a>[2]);</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    }</div>
<div class="line"><a name="l00121"></a><span class="lineno"><a class="line" href="structheffte_1_1box3d.html#ab41101a3a990a0785c3fd78a4f833f30">  121</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="structheffte_1_1box3d.html#ab41101a3a990a0785c3fd78a4f833f30">find_order</a>(<span class="keywordtype">int</span> dir)<span class="keyword"> const</span>{ <span class="keywordflow">return</span> ((dir == <a class="code" href="structheffte_1_1box3d.html#ad5476621fa6cd5053bfe7b33a864f34d">order</a>[0]) ? 0 : ((dir == <a class="code" href="structheffte_1_1box3d.html#ad5476621fa6cd5053bfe7b33a864f34d">order</a>[1]) ? 1 : 2)); }</div>
<div class="line"><a name="l00123"></a><span class="lineno"><a class="line" href="structheffte_1_1box3d.html#af511df6e2d8e03afc2f79e0548acef4b">  123</a></span>&#160;    index <a class="code" href="structheffte_1_1box3d.html#af511df6e2d8e03afc2f79e0548acef4b">osize</a>(<span class="keywordtype">int</span> dimension)<span class="keyword"> const</span>{ <span class="keywordflow">return</span> <a class="code" href="structheffte_1_1box3d.html#a76aea01f1090189c317cfb56ef2e996c">size</a>[<a class="code" href="structheffte_1_1box3d.html#ad5476621fa6cd5053bfe7b33a864f34d">order</a>[dimension]]; }</div>
<div class="line"><a name="l00125"></a><span class="lineno"><a class="line" href="structheffte_1_1box3d.html#aaa4abcee136213388df9ae363e33c8c8">  125</a></span>&#160;    std::array&lt;index, 3&gt; <span class="keyword">const</span> <a class="code" href="structheffte_1_1box3d.html#aaa4abcee136213388df9ae363e33c8c8">low</a>;</div>
<div class="line"><a name="l00127"></a><span class="lineno"><a class="line" href="structheffte_1_1box3d.html#ab86bc20cf1eaba6c4b9b2dcb63033185">  127</a></span>&#160;    std::array&lt;index, 3&gt; <span class="keyword">const</span> <a class="code" href="structheffte_1_1box3d.html#ab86bc20cf1eaba6c4b9b2dcb63033185">high</a>;</div>
<div class="line"><a name="l00129"></a><span class="lineno"><a class="line" href="structheffte_1_1box3d.html#a76aea01f1090189c317cfb56ef2e996c">  129</a></span>&#160;    std::array&lt;index, 3&gt; <span class="keyword">const</span> <a class="code" href="structheffte_1_1box3d.html#a76aea01f1090189c317cfb56ef2e996c">size</a>;</div>
<div class="line"><a name="l00131"></a><span class="lineno"><a class="line" href="structheffte_1_1box3d.html#ad5476621fa6cd5053bfe7b33a864f34d">  131</a></span>&#160;    std::array&lt;int, 3&gt; <span class="keyword">const</span> <a class="code" href="structheffte_1_1box3d.html#ad5476621fa6cd5053bfe7b33a864f34d">order</a>;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;};</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160; </div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">typename</span> index = <span class="keywordtype">int</span>&gt;</div>
<div class="line"><a name="l00139"></a><span class="lineno"><a class="line" href="group__fft3d.html#ga23c21952dcea2e7ab857c2755ff78f03">  139</a></span>&#160;<span class="keyword">using</span> <a class="code" href="structheffte_1_1box3d.html">box2d</a> = <a class="code" href="structheffte_1_1box3d.html">box3d&lt;index&gt;</a>;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160; </div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">typename</span> index&gt;</div>
<div class="line"><a name="l00146"></a><span class="lineno"><a class="line" href="group__fft3dmisc.html#ga73973b90e6bc509951856f46e37c4bc7">  146</a></span>&#160;<span class="keyword">inline</span> std::ostream &amp; <a class="code" href="group__fft3dmisc.html#ga73973b90e6bc509951856f46e37c4bc7">operator &lt;&lt; </a>(std::ostream &amp;os, <a class="code" href="structheffte_1_1box3d.html">box3d&lt;index&gt;</a> <span class="keyword">const</span> box){</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;3; i++)</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        os &lt;&lt; box.<a class="code" href="structheffte_1_1box3d.html#aaa4abcee136213388df9ae363e33c8c8">low</a>[i] &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; box.<a class="code" href="structheffte_1_1box3d.html#ab86bc20cf1eaba6c4b9b2dcb63033185">high</a>[i] &lt;&lt; <span class="stringliteral">&quot;  (&quot;</span> &lt;&lt; box.<a class="code" href="structheffte_1_1box3d.html#a76aea01f1090189c317cfb56ef2e996c">size</a>[i] &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;(&quot;</span> &lt;&lt; box.<a class="code" href="structheffte_1_1box3d.html#ad5476621fa6cd5053bfe7b33a864f34d">order</a>[0] &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; box.<a class="code" href="structheffte_1_1box3d.html#ad5476621fa6cd5053bfe7b33a864f34d">order</a>[1] &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; box.<a class="code" href="structheffte_1_1box3d.html#ad5476621fa6cd5053bfe7b33a864f34d">order</a>[2] &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="keywordflow">return</span> os;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;}</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160; </div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">typename</span> index&gt;</div>
<div class="line"><a name="l00159"></a><span class="lineno"><a class="line" href="group__fft3dbackend.html#ga1fd8db18e1607f12b4e009abb8849626">  159</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__fft3dbackend.html#ga1fd8db18e1607f12b4e009abb8849626">fft1d_get_howmany</a>(<a class="code" href="structheffte_1_1box3d.html">box3d&lt;index&gt;</a> <span class="keyword">const</span> box, <span class="keywordtype">int</span> <span class="keyword">const</span> dimension){</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="keywordflow">if</span> (dimension == box.<a class="code" href="structheffte_1_1box3d.html#ad5476621fa6cd5053bfe7b33a864f34d">order</a>[0]) <span class="keywordflow">return</span> box.<a class="code" href="structheffte_1_1box3d.html#af511df6e2d8e03afc2f79e0548acef4b">osize</a>(1) * box.<a class="code" href="structheffte_1_1box3d.html#af511df6e2d8e03afc2f79e0548acef4b">osize</a>(2);</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="keywordflow">if</span> (dimension == box.<a class="code" href="structheffte_1_1box3d.html#ad5476621fa6cd5053bfe7b33a864f34d">order</a>[1]) <span class="keywordflow">return</span> box.<a class="code" href="structheffte_1_1box3d.html#af511df6e2d8e03afc2f79e0548acef4b">osize</a>(0);</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="keywordflow">return</span> box.<a class="code" href="structheffte_1_1box3d.html#af511df6e2d8e03afc2f79e0548acef4b">osize</a>(0) * box.<a class="code" href="structheffte_1_1box3d.html#af511df6e2d8e03afc2f79e0548acef4b">osize</a>(1);</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;}</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">typename</span> index&gt;</div>
<div class="line"><a name="l00169"></a><span class="lineno"><a class="line" href="group__fft3dbackend.html#ga58cb5cd5676aeec4eecb94ff0111b440">  169</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__fft3dbackend.html#ga58cb5cd5676aeec4eecb94ff0111b440">fft1d_get_stride</a>(<a class="code" href="structheffte_1_1box3d.html">box3d&lt;index&gt;</a> <span class="keyword">const</span> box, <span class="keywordtype">int</span> <span class="keyword">const</span> dimension){</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="keywordflow">if</span> (dimension == box.<a class="code" href="structheffte_1_1box3d.html#ad5476621fa6cd5053bfe7b33a864f34d">order</a>[0]) <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="keywordflow">if</span> (dimension == box.<a class="code" href="structheffte_1_1box3d.html#ad5476621fa6cd5053bfe7b33a864f34d">order</a>[1]) <span class="keywordflow">return</span> box.<a class="code" href="structheffte_1_1box3d.html#af511df6e2d8e03afc2f79e0548acef4b">osize</a>(0);</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="keywordflow">return</span> box.<a class="code" href="structheffte_1_1box3d.html#af511df6e2d8e03afc2f79e0548acef4b">osize</a>(0) * box.<a class="code" href="structheffte_1_1box3d.html#af511df6e2d8e03afc2f79e0548acef4b">osize</a>(1);</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;}</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160; </div>
<div class="line"><a name="l00179"></a><span class="lineno"><a class="line" href="structheffte_1_1rank__remap.html">  179</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structheffte_1_1rank__remap.html">rank_remap</a>{</div>
<div class="line"><a name="l00181"></a><span class="lineno"><a class="line" href="structheffte_1_1rank__remap.html#ae76ef0915e569e14db0a3dc434ee4880">  181</a></span>&#160;    <a class="code" href="structheffte_1_1rank__remap.html#ae76ef0915e569e14db0a3dc434ee4880">rank_remap</a>() : <a class="code" href="structheffte_1_1rank__remap.html#a01a369b104bb599b62cf429b100abed4">mpi_rank</a>(-1), <a class="code" href="structheffte_1_1rank__remap.html#aa2bc6113d63e6eff377100dcb199c0bc">size_subcomm</a>(0){}</div>
<div class="line"><a name="l00183"></a><span class="lineno"><a class="line" href="structheffte_1_1rank__remap.html#ac3ddc0df8798b859555b71635baa65f9">  183</a></span>&#160;    <a class="code" href="structheffte_1_1rank__remap.html#ac3ddc0df8798b859555b71635baa65f9">rank_remap</a>(<span class="keywordtype">int</span> rank) : <a class="code" href="structheffte_1_1rank__remap.html#a01a369b104bb599b62cf429b100abed4">mpi_rank</a>(rank), <a class="code" href="structheffte_1_1rank__remap.html#aa2bc6113d63e6eff377100dcb199c0bc">size_subcomm</a>(0){}</div>
<div class="line"><a name="l00185"></a><span class="lineno"><a class="line" href="structheffte_1_1rank__remap.html#a01a369b104bb599b62cf429b100abed4">  185</a></span>&#160;    <span class="keywordtype">int</span> <span class="keyword">const</span> <a class="code" href="structheffte_1_1rank__remap.html#a01a369b104bb599b62cf429b100abed4">mpi_rank</a>;</div>
<div class="line"><a name="l00187"></a><span class="lineno"><a class="line" href="structheffte_1_1rank__remap.html#ac98db942ac17288ad687e36c480ea6a9">  187</a></span>&#160;    std::vector&lt;int&gt; <a class="code" href="structheffte_1_1rank__remap.html#ac98db942ac17288ad687e36c480ea6a9">map</a>;</div>
<div class="line"><a name="l00189"></a><span class="lineno"><a class="line" href="structheffte_1_1rank__remap.html#a1c9f9e10d2198323088632123ac63ecd">  189</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="structheffte_1_1rank__remap.html#a1c9f9e10d2198323088632123ac63ecd">set_subranks</a>(<span class="keywordtype">size_t</span> all_ranks, <span class="keywordtype">int</span> sub_ranks){</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        <a class="code" href="structheffte_1_1rank__remap.html#aa2bc6113d63e6eff377100dcb199c0bc">size_subcomm</a> = sub_ranks;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        <a class="code" href="structheffte_1_1rank__remap.html#ac98db942ac17288ad687e36c480ea6a9">map</a> = std::vector&lt;int&gt;(all_ranks, -1);</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;sub_ranks; i++) <a class="code" href="structheffte_1_1rank__remap.html#ac98db942ac17288ad687e36c480ea6a9">map</a>[i] = i;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    }</div>
<div class="line"><a name="l00195"></a><span class="lineno"><a class="line" href="structheffte_1_1rank__remap.html#a6ec81f64ae07e6b34debb2283446c723">  195</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="structheffte_1_1rank__remap.html#a6ec81f64ae07e6b34debb2283446c723">set_subranks</a>(MPI_Comm global, MPI_Comm subcomm){</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        <span class="keywordtype">int</span> subcomm_rank = (subcomm == MPI_COMM_NULL) ? -1 : <a class="code" href="group__hefftempi.html#ga5df7514ec8acb2b7bcc642892ed22f67">mpi::comm_rank</a>(subcomm);</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        <a class="code" href="structheffte_1_1rank__remap.html#ac98db942ac17288ad687e36c480ea6a9">map</a> = std::vector&lt;int&gt;(<a class="code" href="group__hefftempi.html#ga6836d729a071bec5c6c82eff2ef17382">mpi::comm_size</a>(global));</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        MPI_Allgather(&amp;subcomm_rank, 1, MPI_INT, <a class="code" href="structheffte_1_1rank__remap.html#ac98db942ac17288ad687e36c480ea6a9">map</a>.data(), 1, MPI_INT, global);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    }</div>
<div class="line"><a name="l00201"></a><span class="lineno"><a class="line" href="structheffte_1_1rank__remap.html#aa2bc6113d63e6eff377100dcb199c0bc">  201</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="structheffte_1_1rank__remap.html#aa2bc6113d63e6eff377100dcb199c0bc">size_subcomm</a>;</div>
<div class="line"><a name="l00203"></a><span class="lineno"><a class="line" href="structheffte_1_1rank__remap.html#a7fb8c0864d86f17860e784b568df09db">  203</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="structheffte_1_1rank__remap.html#a7fb8c0864d86f17860e784b568df09db">empty</a>()<span class="keyword"> const</span>{ <span class="keywordflow">return</span> <a class="code" href="structheffte_1_1rank__remap.html#ac98db942ac17288ad687e36c480ea6a9">map</a>.empty(); }</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;};</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160; </div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">typename</span> index = <span class="keywordtype">int</span>&gt;</div>
<div class="line"><a name="l00213"></a><span class="lineno"><a class="line" href="structheffte_1_1ioboxes.html">  213</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structheffte_1_1ioboxes.html">ioboxes</a>{</div>
<div class="line"><a name="l00215"></a><span class="lineno"><a class="line" href="structheffte_1_1ioboxes.html#a8a3ae817182181f2506a94127346c8d0">  215</a></span>&#160;    std::vector&lt;box3d&lt;index&gt;&gt; <a class="code" href="structheffte_1_1ioboxes.html#a8a3ae817182181f2506a94127346c8d0">in</a>;</div>
<div class="line"><a name="l00217"></a><span class="lineno"><a class="line" href="structheffte_1_1ioboxes.html#ab864204811ea50a1f2e52020e0b46345">  217</a></span>&#160;    std::vector&lt;box3d&lt;index&gt;&gt; <a class="code" href="structheffte_1_1ioboxes.html#ab864204811ea50a1f2e52020e0b46345">out</a>;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;};</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160; </div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">typename</span> index&gt;</div>
<div class="line"><a name="l00229"></a><span class="lineno"><a class="line" href="group__fft3dgeometry.html#ga9d66a94e08af65b980ed89db972f38bd">  229</a></span>&#160;<span class="keyword">inline</span> <a class="code" href="structheffte_1_1box3d.html">box3d&lt;index&gt;</a> <a class="code" href="group__fft3dgeometry.html#ga9d66a94e08af65b980ed89db972f38bd">find_world</a>(std::vector&lt;<a class="code" href="structheffte_1_1box3d.html">box3d&lt;index&gt;</a>&gt; <span class="keyword">const</span> &amp;boxes){</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    std::array&lt;index, 3&gt; low  = boxes[0].low;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    std::array&lt;index, 3&gt; high = boxes[0].high;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="keywordflow">for</span>(<span class="keyword">auto</span> b : boxes){</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        <span class="keywordflow">for</span>(index i=0; i&lt;3; i++)</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;            low[i] = std::min(low[i], b.low[i]);</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        <span class="keywordflow">for</span>(index i=0; i&lt;3; i++)</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;            high[i] = std::max(high[i], b.high[i]);</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    }</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="keywordflow">return</span> {low, high};</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;}</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160; </div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">typename</span> index&gt;</div>
<div class="line"><a name="l00246"></a><span class="lineno"><a class="line" href="group__fft3dgeometry.html#ga6bd726124c213a08070ad54587a08cee">  246</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="group__fft3dgeometry.html#ga6bd726124c213a08070ad54587a08cee">match</a>(std::vector&lt;<a class="code" href="structheffte_1_1box3d.html">box3d&lt;index&gt;</a>&gt; <span class="keyword">const</span> &amp;shape0, std::vector&lt;<a class="code" href="structheffte_1_1box3d.html">box3d&lt;index&gt;</a>&gt; <span class="keyword">const</span> &amp;shape1){</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="keywordflow">if</span> (shape0.size() != shape1.size()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i=0; i&lt;shape0.size(); i++)</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        <span class="keywordflow">if</span> (shape0[i] != shape1[i])</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;}</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160; </div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">typename</span> index&gt;</div>
<div class="line"><a name="l00266"></a><span class="lineno"><a class="line" href="group__fft3dgeometry.html#ga8d500c39e313762adba77fba0901dad7">  266</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="group__fft3dgeometry.html#ga8d500c39e313762adba77fba0901dad7">world_complete</a>(std::vector&lt;<a class="code" href="structheffte_1_1box3d.html">box3d&lt;index&gt;</a>&gt; <span class="keyword">const</span> &amp;boxes, <a class="code" href="structheffte_1_1box3d.html">box3d&lt;index&gt;</a> <span class="keyword">const</span> world){</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="keywordtype">long</span> <span class="keywordtype">long</span> wsize = 0;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="keywordflow">for</span>(<span class="keyword">auto</span> b : boxes) wsize += b.count();</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <span class="keywordflow">if</span> (wsize &lt; world.<a class="code" href="structheffte_1_1box3d.html#a8bce7ff43ff4483ccfd80c372bb819a6">count</a>())</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        <span class="keywordflow">throw</span> std::invalid_argument(<span class="stringliteral">&quot;The provided input boxes do not fill the world box!&quot;</span>);</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160; </div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i=0; i&lt;3; i++)</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        <span class="keywordflow">if</span> (world.<a class="code" href="structheffte_1_1box3d.html#aaa4abcee136213388df9ae363e33c8c8">low</a>[i] != 0)</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;            <span class="keywordflow">throw</span> std::invalid_argument(<span class="stringliteral">&quot;Global box indexing must start from 0!&quot;</span>);</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160; </div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i=0; i&lt;boxes.size(); i++)</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> j=0; j&lt;boxes.size(); j++)</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;            <span class="keywordflow">if</span> (i != j and not boxes[i].collide(boxes[j]).empty())</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                <span class="keywordflow">throw</span> std::invalid_argument(<span class="stringliteral">&quot;Input boxes cannot overlap!&quot;</span>);</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160; </div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;}</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160; </div>
<div class="line"><a name="l00301"></a><span class="lineno"><a class="line" href="namespaceheffte.html#a4b817c023bc9e8c24fdb38287d777824">  301</a></span>&#160;<span class="keyword">inline</span> std::vector&lt;std::array&lt;int, 2&gt;&gt; <a class="code" href="namespaceheffte.html#a4b817c023bc9e8c24fdb38287d777824">get_factors</a>(<span class="keywordtype">int</span> <span class="keyword">const</span> n){</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    std::vector&lt;std::array&lt;int, 2&gt;&gt; result;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=1; i&lt;=n; i++){</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        <span class="keywordflow">if</span> (n % i == 0)</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;            result.push_back({i, n / i});</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    }</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="keywordflow">if</span> (n == 1) {</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        result.push_back({1, 1});</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    }</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;}</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160; </div>
<div class="line"><a name="l00321"></a><span class="lineno"><a class="line" href="group__fft3dmisc.html#ga7e00c74d38b3c5aa16877e6bca80e188">  321</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__fft3dmisc.html#ga7e00c74d38b3c5aa16877e6bca80e188">get_area</a>(std::array&lt;int, 2&gt; <span class="keyword">const</span> &amp;dims){ <span class="keywordflow">return</span> dims[0] * dims[1] + dims[0] + dims[1]; }</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160; </div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160; </div>
<div class="line"><a name="l00336"></a><span class="lineno"><a class="line" href="group__fft3dmisc.html#ga476bab982edff617f057b5284d6ec07f">  336</a></span>&#160;<span class="keyword">inline</span> std::array&lt;int, 2&gt; <a class="code" href="group__fft3dmisc.html#ga476bab982edff617f057b5284d6ec07f">make_procgrid</a>(<span class="keywordtype">int</span> <span class="keyword">const</span> num_procs){</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <span class="keyword">auto</span> factors = <a class="code" href="namespaceheffte.html#a4b817c023bc9e8c24fdb38287d777824">get_factors</a>(num_procs);</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    std::array&lt;int, 2&gt; min_array = factors.front();</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <span class="keywordtype">int</span> min_area = <a class="code" href="group__fft3dmisc.html#ga7e00c74d38b3c5aa16877e6bca80e188">get_area</a>(min_array);</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <span class="keywordflow">for</span>(<span class="keyword">auto</span> f : factors){</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        <span class="keywordtype">int</span> farea = <a class="code" href="group__fft3dmisc.html#ga7e00c74d38b3c5aa16877e6bca80e188">get_area</a>(f);</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        <span class="keywordflow">if</span> (farea &lt; min_area){</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;            min_array = f;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;            min_area = farea;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        }</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    }</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <span class="keywordflow">return</span> min_array;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;}</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160; </div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">typename</span> index&gt;</div>
<div class="line"><a name="l00362"></a><span class="lineno"><a class="line" href="group__fft3dmisc.html#ga4b02bfa36d3805055f797a34c125e410">  362</a></span>&#160;<span class="keyword">inline</span> std::array&lt;int, 3&gt; <a class="code" href="group__fft3dmisc.html#ga4b02bfa36d3805055f797a34c125e410">make_procgrid2d</a>(<a class="code" href="structheffte_1_1box3d.html">box3d&lt;index&gt;</a> <span class="keyword">const</span> world, <span class="keywordtype">int</span> direction_1d, std::array&lt;int, 2&gt; <span class="keyword">const</span> candidate_grid){</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <span class="keyword">auto</span> make_grid = [&amp;](std::array&lt;int, 2&gt; <span class="keyword">const</span> &amp;grid)</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                     -&gt;std::array&lt;int, 3&gt;{</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;                         <span class="keywordflow">return</span>  (direction_1d == 0) ?  std::array&lt;int, 3&gt;{1, grid[0], grid[1]} :</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;                                ((direction_1d == 1) ? std::array&lt;int, 3&gt;{grid[0], 1, grid[1]} :</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;                                                       std::array&lt;int, 3&gt;{grid[0], grid[1], 1});</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;                     };</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    std::array&lt;int, 3&gt; result = make_grid(candidate_grid);</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160; </div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <span class="keyword">auto</span> valid = [&amp;](std::array&lt;int, 3&gt; <span class="keyword">const</span> &amp;grid)</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                 -&gt;<span class="keywordtype">bool</span>{</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;3; i++) <span class="keywordflow">if</span> (grid[i] &gt; world.<a class="code" href="structheffte_1_1box3d.html#a76aea01f1090189c317cfb56ef2e996c">size</a>[i]) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                     <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                 };</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <span class="keywordflow">if</span> (valid(result)) <span class="keywordflow">return</span> result; <span class="comment">// if the first constraint is OK</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160; </div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="comment">// otherwise seek a new factorization</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="keyword">auto</span> factors = <a class="code" href="namespaceheffte.html#a4b817c023bc9e8c24fdb38287d777824">get_factors</a>(candidate_grid[0] * candidate_grid[1]);</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160; </div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <span class="keywordtype">int</span> min_area = <a class="code" href="group__fft3dmisc.html#ga7e00c74d38b3c5aa16877e6bca80e188">get_area</a>(factors.front());</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <span class="comment">// a bit misleading, but here we initialize min_area with the largest possible area</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <span class="keywordflow">for</span>(<span class="keyword">auto</span> <span class="keyword">const</span> &amp;g : factors) min_area = std::max(min_area, <a class="code" href="group__fft3dmisc.html#ga7e00c74d38b3c5aa16877e6bca80e188">get_area</a>(g));</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160; </div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <span class="keywordflow">for</span>(<span class="keyword">auto</span> <span class="keyword">const</span> &amp;g : factors){</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;        <span class="keywordflow">if</span> (valid(make_grid(g)) and <a class="code" href="group__fft3dmisc.html#ga7e00c74d38b3c5aa16877e6bca80e188">get_area</a>(g) &lt;= min_area){</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;            result = make_grid(g);</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;            min_area = <a class="code" href="group__fft3dmisc.html#ga7e00c74d38b3c5aa16877e6bca80e188">get_area</a>(g);</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        }</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    }</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160; </div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <span class="keywordflow">if</span> (not valid(result)) <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;Cannot split the given number of indexes into the given set of mpi-ranks. Most liklely, the number of indexes is too small compared to the number of mpi-ranks.&quot;</span>);</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160; </div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;}</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160; </div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">typename</span> index&gt;</div>
<div class="line"><a name="l00409"></a><span class="lineno"><a class="line" href="group__fft3dgeometry.html#gab09d26871c884a0523c97d7f48d10efe">  409</a></span>&#160;<span class="keyword">inline</span> std::vector&lt;box3d&lt;index&gt;&gt; <a class="code" href="group__fft3dgeometry.html#gab09d26871c884a0523c97d7f48d10efe">split_world</a>(<a class="code" href="structheffte_1_1box3d.html">box3d&lt;index&gt;</a> <span class="keyword">const</span> world, std::array&lt;int, 3&gt; <span class="keyword">const</span> proc_grid, <a class="code" href="structheffte_1_1rank__remap.html">rank_remap</a> <span class="keyword">const</span> &amp;remap = <a class="code" href="structheffte_1_1rank__remap.html">rank_remap</a>()){</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160; </div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <span class="keyword">auto</span> fast = [=](index i)-&gt;index{ <span class="keywordflow">return</span> world.<a class="code" href="structheffte_1_1box3d.html#aaa4abcee136213388df9ae363e33c8c8">low</a>[0] + i * (world.<a class="code" href="structheffte_1_1box3d.html#a76aea01f1090189c317cfb56ef2e996c">size</a>[0] / proc_grid[0]) + std::min(i, (world.<a class="code" href="structheffte_1_1box3d.html#a76aea01f1090189c317cfb56ef2e996c">size</a>[0] % proc_grid[0])); };</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    <span class="keyword">auto</span> mid  = [=](index i)-&gt;index{ <span class="keywordflow">return</span> world.<a class="code" href="structheffte_1_1box3d.html#aaa4abcee136213388df9ae363e33c8c8">low</a>[1] + i * (world.<a class="code" href="structheffte_1_1box3d.html#a76aea01f1090189c317cfb56ef2e996c">size</a>[1] / proc_grid[1]) + std::min(i, (world.<a class="code" href="structheffte_1_1box3d.html#a76aea01f1090189c317cfb56ef2e996c">size</a>[1] % proc_grid[1])); };</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <span class="keyword">auto</span> slow = [=](index i)-&gt;index{ <span class="keywordflow">return</span> world.<a class="code" href="structheffte_1_1box3d.html#aaa4abcee136213388df9ae363e33c8c8">low</a>[2] + i * (world.<a class="code" href="structheffte_1_1box3d.html#a76aea01f1090189c317cfb56ef2e996c">size</a>[2] / proc_grid[2]) + std::min(i, (world.<a class="code" href="structheffte_1_1box3d.html#a76aea01f1090189c317cfb56ef2e996c">size</a>[2] % proc_grid[2])); };</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160; </div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    std::vector&lt;box3d&lt;index&gt;&gt; result;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    result.reserve(proc_grid[0] * proc_grid[1] * proc_grid[2]);</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    <span class="keywordflow">for</span>(index k = 0; k &lt; proc_grid[2]; k++){</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        <span class="keywordflow">for</span>(index j = 0; j &lt; proc_grid[1]; j++){</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;            <span class="keywordflow">for</span>(index i = 0; i &lt; proc_grid[0]; i++){</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;                result.push_back(<a class="code" href="structheffte_1_1box3d.html">box3d&lt;index&gt;</a>({fast(i), mid(j), slow(k)}, {fast(i+1)-1, mid(j+1)-1, slow(k+1)-1}, world.<a class="code" href="structheffte_1_1box3d.html#ad5476621fa6cd5053bfe7b33a864f34d">order</a>));</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;            }</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        }</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    }</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    <span class="keywordflow">if</span> (remap.empty()){</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;        <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;        std::vector&lt;box3d&lt;index&gt;&gt; remapped_result;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i=0; i&lt;remap.map.size(); i++)</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;            remapped_result.push_back( (remap.map[i] == -1) ?</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;                                       <a class="code" href="structheffte_1_1box3d.html">box3d&lt;index&gt;</a>(std::array&lt;index, 3&gt;{0, 0, 0}, std::array&lt;index, 3&gt;{-1, -1, -1}, world.<a class="code" href="structheffte_1_1box3d.html#ad5476621fa6cd5053bfe7b33a864f34d">order</a>) :</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;                                       result[remap.map[i]]</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;                            );</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        <span class="keywordflow">return</span> remapped_result;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    }</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;}</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160; </div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">typename</span> index&gt;</div>
<div class="line"><a name="l00442"></a><span class="lineno"><a class="line" href="group__fft3dgeometry.html#ga1ff6700360dd5bea7caa67d8f1ad4012">  442</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="group__fft3dgeometry.html#ga1ff6700360dd5bea7caa67d8f1ad4012">is_pencils</a>(<a class="code" href="structheffte_1_1box3d.html">box3d&lt;index&gt;</a> <span class="keyword">const</span> world, std::vector&lt;<a class="code" href="structheffte_1_1box3d.html">box3d&lt;index&gt;</a>&gt; <span class="keyword">const</span> &amp;shape, <span class="keywordtype">int</span> <a class="code" href="group__fft3dmisc.html#ga2738b0dcfd330cf26181036ee5133a09">direction</a>){</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <span class="keywordflow">for</span>(<span class="keyword">auto</span> s : shape)</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        <span class="keywordflow">if</span> (s.size[<a class="code" href="group__fft3dmisc.html#ga2738b0dcfd330cf26181036ee5133a09">direction</a>] != world.<a class="code" href="structheffte_1_1box3d.html#a76aea01f1090189c317cfb56ef2e996c">size</a>[<a class="code" href="group__fft3dmisc.html#ga2738b0dcfd330cf26181036ee5133a09">direction</a>])</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;}</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160; </div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">typename</span> index&gt;</div>
<div class="line"><a name="l00454"></a><span class="lineno"><a class="line" href="group__fft3dgeometry.html#ga61787c57c8ba9cf24d2bbe9a702e9a61">  454</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="group__fft3dgeometry.html#ga61787c57c8ba9cf24d2bbe9a702e9a61">is_slab</a>(<a class="code" href="structheffte_1_1box3d.html">box3d&lt;index&gt;</a> <span class="keyword">const</span> world, std::vector&lt;<a class="code" href="structheffte_1_1box3d.html">box3d&lt;index&gt;</a>&gt; <span class="keyword">const</span> &amp;shape, <span class="keywordtype">int</span> direction1, <span class="keywordtype">int</span> direction2){</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <span class="keywordflow">for</span>(<span class="keyword">auto</span> s : shape)</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;        <span class="keywordflow">if</span> (s.size[direction1] != world.<a class="code" href="structheffte_1_1box3d.html#a76aea01f1090189c317cfb56ef2e996c">size</a>[direction1] or s.size[direction2] != world.<a class="code" href="structheffte_1_1box3d.html#a76aea01f1090189c317cfb56ef2e996c">size</a>[direction2])</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;}</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160; </div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">typename</span> index&gt;</div>
<div class="line"><a name="l00466"></a><span class="lineno"><a class="line" href="group__fft3dgeometry.html#gaaeffaad7ebc798b6e829789ee8c22b24">  466</a></span>&#160;<span class="keyword">inline</span> std::vector&lt;box3d&lt;index&gt;&gt; <a class="code" href="group__fft3dgeometry.html#gaaeffaad7ebc798b6e829789ee8c22b24">reorder</a>(std::vector&lt;<a class="code" href="structheffte_1_1box3d.html">box3d&lt;index&gt;</a>&gt; <span class="keyword">const</span> &amp;shape, std::array&lt;int, 3&gt; order){</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    std::vector&lt;box3d&lt;index&gt;&gt; result;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    result.reserve(shape.size());</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="keywordflow">for</span>(<span class="keyword">auto</span> <span class="keyword">const</span> &amp;b : shape)</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;        result.push_back(<a class="code" href="structheffte_1_1box3d.html">box3d&lt;index&gt;</a>(b.low, b.high, order));</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;}</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160; </div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">typename</span> index&gt;</div>
<div class="line"><a name="l00489"></a><span class="lineno"><a class="line" href="group__fft3dgeometry.html#ga9a9004258695f15f6c9d0cffe8017a62">  489</a></span>&#160;<span class="keyword">inline</span> std::vector&lt;box3d&lt;index&gt;&gt; <a class="code" href="group__fft3dgeometry.html#ga9a9004258695f15f6c9d0cffe8017a62">maximize_overlap</a>(std::vector&lt;<a class="code" href="structheffte_1_1box3d.html">box3d&lt;index&gt;</a>&gt; <span class="keyword">const</span> &amp;new_boxes,</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;                                                  std::vector&lt;<a class="code" href="structheffte_1_1box3d.html">box3d&lt;index&gt;</a>&gt; <span class="keyword">const</span> &amp;old_boxes,</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;                                                  std::array&lt;int, 3&gt; <span class="keyword">const</span> order,</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;                                                  <a class="code" href="structheffte_1_1rank__remap.html">rank_remap</a> <span class="keyword">const</span> &amp;remap){</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    std::vector&lt;box3d&lt;index&gt;&gt; result;</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    result.reserve(new_boxes.size());</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    std::vector&lt;bool&gt; taken(new_boxes.size(), <span class="keyword">false</span>);</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    <span class="keywordflow">if</span> (not remap.<a class="code" href="structheffte_1_1rank__remap.html#a7fb8c0864d86f17860e784b568df09db">empty</a>()){</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i=0; i&lt;remap.<a class="code" href="structheffte_1_1rank__remap.html#ac98db942ac17288ad687e36c480ea6a9">map</a>.size(); i++)</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;            <span class="keywordflow">if</span> (remap.<a class="code" href="structheffte_1_1rank__remap.html#ac98db942ac17288ad687e36c480ea6a9">map</a>[i] == -1) taken[i] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    }</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160; </div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i=0; i&lt;new_boxes.size(); i++){</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        <span class="keywordflow">if</span> (not remap.<a class="code" href="structheffte_1_1rank__remap.html#a7fb8c0864d86f17860e784b568df09db">empty</a>() and remap.<a class="code" href="structheffte_1_1rank__remap.html#ac98db942ac17288ad687e36c480ea6a9">map</a>[i] == -1){</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;            result.push_back(<a class="code" href="structheffte_1_1box3d.html">box3d&lt;index&gt;</a>(new_boxes[i].low, new_boxes[i].high, order));</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        }</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        <span class="comment">// for each box in the result, find the box among the new_boxes</span></div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;        <span class="comment">// that has not been taken and has the largest overlap with the corresponding old box</span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        <span class="keywordtype">int</span> max_overlap = -1;</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        <span class="keywordtype">size_t</span> max_index = new_boxes.size();</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> j=0; j&lt;new_boxes.size(); j++){</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;            <span class="keywordtype">int</span> overlap = old_boxes[i].collide(new_boxes[j]).count();</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;            <span class="keywordflow">if</span> (not taken[j] and overlap &gt; max_overlap){</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;                max_overlap = overlap;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;                max_index = j;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;            }</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;        }</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        assert( max_index &lt; new_boxes.size() ); <span class="comment">// if we found a box</span></div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        taken[max_index] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        result.push_back(<a class="code" href="structheffte_1_1box3d.html">box3d&lt;index&gt;</a>(new_boxes[max_index].low, new_boxes[max_index].high, order));</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    }</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160; </div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;}</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160; </div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">typename</span> index&gt;</div>
<div class="line"><a name="l00535"></a><span class="lineno"><a class="line" href="group__fft3dgeometry.html#gae060cb9f8d719ad2007d51ca4e6ef1b0">  535</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <a class="code" href="group__fft3dgeometry.html#gae060cb9f8d719ad2007d51ca4e6ef1b0">count_connections</a>(std::vector&lt;<a class="code" href="structheffte_1_1box3d.html">box3d&lt;index&gt;</a>&gt; <span class="keyword">const</span> &amp;new_boxes, std::vector&lt;<a class="code" href="structheffte_1_1box3d.html">box3d&lt;index&gt;</a>&gt; <span class="keyword">const</span> &amp;old_boxes){</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    <span class="keywordtype">long</span> <span class="keywordtype">long</span> count = 0;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160; </div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <span class="keywordflow">for</span>(<span class="keyword">auto</span> &amp;nbox : new_boxes)</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;        <span class="keywordflow">for</span>(<span class="keyword">auto</span> &amp;obox : old_boxes)</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;            <span class="keywordflow">if</span> (not nbox.collide(obox).empty())</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;                count++;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160; </div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    <span class="keywordflow">return</span> count;</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;}</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160; </div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">typename</span> index&gt;</div>
<div class="line"><a name="l00568"></a><span class="lineno"><a class="line" href="group__fft3dgeometry.html#gacc239bfe5a333acdb4ca86b3b31a8fa6">  568</a></span>&#160;<span class="keyword">inline</span> std::vector&lt;box3d&lt;index&gt;&gt; <a class="code" href="group__fft3dgeometry.html#gacc239bfe5a333acdb4ca86b3b31a8fa6">make_pencils</a>(<a class="code" href="structheffte_1_1box3d.html">box3d&lt;index&gt;</a> <span class="keyword">const</span> world,</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;                                              std::array&lt;int, 2&gt; <span class="keyword">const</span> proc_grid,</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;                                              <span class="keywordtype">int</span> <span class="keyword">const</span> dimension,</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;                                              std::vector&lt;<a class="code" href="structheffte_1_1box3d.html">box3d&lt;index&gt;</a>&gt; <span class="keyword">const</span> &amp;source,</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;                                              std::array&lt;int, 3&gt; <span class="keyword">const</span> order,</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;                                              <a class="code" href="structheffte_1_1rank__remap.html">rank_remap</a> <span class="keyword">const</span> &amp;remap = <a class="code" href="structheffte_1_1rank__remap.html">rank_remap</a>()</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;                                             ){</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    <span class="comment">// trivial case, the grid is already in a pencil format</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="group__fft3dgeometry.html#ga1ff6700360dd5bea7caa67d8f1ad4012">is_pencils</a>(world, source, dimension))</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__fft3dgeometry.html#gaaeffaad7ebc798b6e829789ee8c22b24">reorder</a>(source, order);</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160; </div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    <span class="comment">// create a list of boxes ordered in column major format (following the proc_grid box)</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    <span class="comment">// using two boxes corresponding to the two dimensions of proc-grid in both variants</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    std::vector&lt;box3d&lt;index&gt;&gt; pencilsA =</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        <a class="code" href="group__fft3dgeometry.html#ga9a9004258695f15f6c9d0cffe8017a62">maximize_overlap</a>(</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;            <a class="code" href="group__fft3dgeometry.html#gab09d26871c884a0523c97d7f48d10efe">split_world</a>(world, <a class="code" href="group__fft3dmisc.html#ga4b02bfa36d3805055f797a34c125e410">make_procgrid2d</a>(world, dimension, proc_grid), remap), source, order, remap);</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160; </div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    std::vector&lt;box3d&lt;index&gt;&gt; pencilsB =</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        <a class="code" href="group__fft3dgeometry.html#ga9a9004258695f15f6c9d0cffe8017a62">maximize_overlap</a>(</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;            <a class="code" href="group__fft3dgeometry.html#gab09d26871c884a0523c97d7f48d10efe">split_world</a>(world, <a class="code" href="group__fft3dmisc.html#ga4b02bfa36d3805055f797a34c125e410">make_procgrid2d</a>(world, dimension, std::array&lt;int, 2&gt;{proc_grid[1], proc_grid[0]}), remap), source, order, remap);</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160; </div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    <span class="keywordflow">return</span> (<a class="code" href="group__fft3dgeometry.html#gae060cb9f8d719ad2007d51ca4e6ef1b0">count_connections</a>(pencilsB, source) &lt; <a class="code" href="group__fft3dgeometry.html#gae060cb9f8d719ad2007d51ca4e6ef1b0">count_connections</a>(pencilsA, source)) ? pencilsB : pencilsA;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;}</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160; </div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">typename</span> index&gt;</div>
<div class="line"><a name="l00599"></a><span class="lineno"><a class="line" href="group__fft3dgeometry.html#ga0209c93b14c17886aa2673320fe3d974">  599</a></span>&#160;<span class="keyword">inline</span> std::vector&lt;box3d&lt;index&gt;&gt; <a class="code" href="group__fft3dgeometry.html#ga0209c93b14c17886aa2673320fe3d974">make_slabs</a>(<a class="code" href="structheffte_1_1box3d.html">box3d&lt;index&gt;</a> <span class="keyword">const</span> world, <span class="keywordtype">int</span> num_slabs,</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;                                            <span class="keywordtype">int</span> <span class="keyword">const</span> dimension1, <span class="keywordtype">int</span> <span class="keyword">const</span> dimension2,</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;                                            std::vector&lt;<a class="code" href="structheffte_1_1box3d.html">box3d&lt;index&gt;</a>&gt; <span class="keyword">const</span> &amp;source,</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;                                            std::array&lt;int, 3&gt; <span class="keyword">const</span> order,</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;                                            <a class="code" href="structheffte_1_1rank__remap.html">rank_remap</a> <span class="keyword">const</span> &amp;remap</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;                                           ){</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    assert( dimension1 != dimension2 );</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    std::vector&lt;box3d&lt;index&gt;&gt; slabs;</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    <span class="keywordflow">if</span> (dimension1 == 0){</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        <span class="keywordflow">if</span> (dimension2 == 1){</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;            slabs = <a class="code" href="group__fft3dgeometry.html#gab09d26871c884a0523c97d7f48d10efe">split_world</a>(world, {1, 1, num_slabs}, remap);</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;            slabs = <a class="code" href="group__fft3dgeometry.html#gab09d26871c884a0523c97d7f48d10efe">split_world</a>(world, {1, num_slabs, 1}, remap);</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        }</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    }<span class="keywordflow">else</span> <span class="keywordflow">if</span> (dimension1 == 1){</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;        <span class="keywordflow">if</span> (dimension2 == 0){</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;            slabs = <a class="code" href="group__fft3dgeometry.html#gab09d26871c884a0523c97d7f48d10efe">split_world</a>(world, {1, 1, num_slabs}, remap);</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;        }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;            slabs = <a class="code" href="group__fft3dgeometry.html#gab09d26871c884a0523c97d7f48d10efe">split_world</a>(world, {num_slabs, 1, 1}, remap);</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;        }</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    }<span class="keywordflow">else</span>{ <span class="comment">// third dimension</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;        <span class="keywordflow">if</span> (dimension2 == 0){</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;            slabs = <a class="code" href="group__fft3dgeometry.html#gab09d26871c884a0523c97d7f48d10efe">split_world</a>(world, {1, num_slabs, 1}, remap);</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;        }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;            slabs = <a class="code" href="group__fft3dgeometry.html#gab09d26871c884a0523c97d7f48d10efe">split_world</a>(world, {num_slabs, 1, 1}, remap);</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;        }</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    }</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160; </div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="group__fft3dgeometry.html#ga9a9004258695f15f6c9d0cffe8017a62">maximize_overlap</a>(slabs, source, order, remap);</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;}</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160; </div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">typename</span> index&gt;</div>
<div class="line"><a name="l00643"></a><span class="lineno"><a class="line" href="group__fft3dgeometry.html#ga80a897b86af45ff818a86e8cab52ee62">  643</a></span>&#160;<span class="keyword">inline</span> std::array&lt;int, 3&gt; <a class="code" href="group__fft3dgeometry.html#ga80a897b86af45ff818a86e8cab52ee62">proc_setup_min_surface</a>(<a class="code" href="structheffte_1_1box3d.html">box3d&lt;index&gt;</a> <span class="keyword">const</span> world, <span class="keywordtype">int</span> num_procs){</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    assert(world.<a class="code" href="structheffte_1_1box3d.html#a8bce7ff43ff4483ccfd80c372bb819a6">count</a>() &gt; 0); <span class="comment">// make sure the world is not empty</span></div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160; </div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    <span class="comment">// using valarrays that work much like vectors, but can perform basic</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    <span class="comment">// point-wise operations such as addition, multiply, and division</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    std::valarray&lt;index&gt; all_indexes = {world.<a class="code" href="structheffte_1_1box3d.html#a76aea01f1090189c317cfb56ef2e996c">size</a>[0], world.<a class="code" href="structheffte_1_1box3d.html#a76aea01f1090189c317cfb56ef2e996c">size</a>[1], world.<a class="code" href="structheffte_1_1box3d.html#a76aea01f1090189c317cfb56ef2e996c">size</a>[2]};</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    <span class="comment">// set initial guess, probably the worst grid but a valid one</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    std::valarray&lt;index&gt; best_grid = {1, 1, num_procs};</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160; </div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    <span class="comment">// internal helper method to compute the surface</span></div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    <span class="keyword">auto</span> surface = [&amp;](std::valarray&lt;index&gt; <span class="keyword">const</span> &amp;proc_grid)-&gt;</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;        index{</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;            <span class="keyword">auto</span> box_size = all_indexes / proc_grid;</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;            <span class="keywordflow">return</span> ( box_size * box_size.cshift(1) ).sum();</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;        };</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160; </div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    index best_surface = surface({1, 1, num_procs});</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160; </div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=1; i&lt;=num_procs; i++){</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;        <span class="keywordflow">if</span> (num_procs % i == 0){</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;            <span class="keywordtype">int</span> <span class="keyword">const</span> remainder = num_procs / i;</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=1; j&lt;=remainder; j++){</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;                <span class="keywordflow">if</span> (remainder % j == 0){</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;                    std::valarray&lt;index&gt; candidate_grid = {i, j, remainder / j};</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;                    index <span class="keyword">const</span> candidate_surface = surface(candidate_grid);</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;                    <span class="keywordflow">if</span> (candidate_surface &lt; best_surface){</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;                        best_surface = candidate_surface;</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;                        best_grid    = candidate_grid;</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;                    }</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;                }</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;            }</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;        }</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    }</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160; </div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    assert(best_grid[0] * best_grid[1] * best_grid[2] == num_procs);</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160; </div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    <span class="keywordflow">return</span> {<span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(best_grid[0]), <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(best_grid[1]), <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(best_grid[2])};</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;}</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160; </div>
<div class="line"><a name="l00682"></a><span class="lineno"><a class="line" href="namespaceheffte_1_1mpi.html">  682</a></span>&#160;<span class="keyword">namespace </span>mpi {</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">typename</span> index&gt;</div>
<div class="line"><a name="l00697"></a><span class="lineno"><a class="line" href="group__hefftempi.html#gacade914d344f3727d9e7d8dcfd13ed5a">  697</a></span>&#160;<span class="keyword">inline</span> <a class="code" href="structheffte_1_1ioboxes.html">ioboxes&lt;index&gt;</a> <a class="code" href="group__hefftempi.html#gacade914d344f3727d9e7d8dcfd13ed5a">gather_boxes</a>(<a class="code" href="structheffte_1_1box3d.html">box3d&lt;index&gt;</a> <span class="keyword">const</span> my_inbox, <a class="code" href="structheffte_1_1box3d.html">box3d&lt;index&gt;</a> <span class="keyword">const</span> my_outbox, MPI_Comm <span class="keyword">const</span> comm){</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    std::array&lt;box3d&lt;index&gt;, 2&gt; my_data = {my_inbox, my_outbox};</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;    std::vector&lt;box3d&lt;index&gt;&gt; all_boxes(2 * <a class="code" href="group__hefftempi.html#ga6836d729a071bec5c6c82eff2ef17382">mpi::comm_size</a>(comm), <a class="code" href="structheffte_1_1box3d.html">box3d&lt;index&gt;</a>({0, 0, 0}, {0, 0, 0}));</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    MPI_Allgather(&amp;my_data, 2 * <span class="keyword">sizeof</span>(<a class="code" href="structheffte_1_1box3d.html">box3d&lt;index&gt;</a>), MPI_BYTE, all_boxes.data(), 2 * <span class="keyword">sizeof</span>(<a class="code" href="structheffte_1_1box3d.html">box3d&lt;index&gt;</a>), MPI_BYTE, comm);</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    <a class="code" href="structheffte_1_1ioboxes.html">ioboxes&lt;index&gt;</a> result;</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    <span class="keywordflow">for</span>(<span class="keyword">auto</span> i = all_boxes.begin(); i &lt; all_boxes.end(); i += 2){</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;        result.<a class="code" href="structheffte_1_1ioboxes.html#a8a3ae817182181f2506a94127346c8d0">in</a>.push_back(*i);</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;        result.<a class="code" href="structheffte_1_1ioboxes.html#ab864204811ea50a1f2e52020e0b46345">out</a>.push_back(*(i+1));</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    }</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;}</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160; </div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;}</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160; </div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;}</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160; </div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160; </div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* HEFFTE_GEOMETRY_H */</span><span class="preprocessor"></span></div>
<div class="ttc" id="agroup__fft3dbackend_html_ga1fd8db18e1607f12b4e009abb8849626"><div class="ttname"><a href="group__fft3dbackend.html#ga1fd8db18e1607f12b4e009abb8849626">heffte::fft1d_get_howmany</a></div><div class="ttdeci">int fft1d_get_howmany(box3d&lt; index &gt; const box, int const dimension)</div><div class="ttdoc">Return the number of 1-D ffts contained in the box in the given dimension.</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:159</div></div>
<div class="ttc" id="agroup__fft3dbackend_html_ga58cb5cd5676aeec4eecb94ff0111b440"><div class="ttname"><a href="group__fft3dbackend.html#ga58cb5cd5676aeec4eecb94ff0111b440">heffte::fft1d_get_stride</a></div><div class="ttdeci">int fft1d_get_stride(box3d&lt; index &gt; const box, int const dimension)</div><div class="ttdoc">Return the stride of the 1-D ffts contained in the box in the given dimension.</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:169</div></div>
<div class="ttc" id="agroup__fft3dgeometry_html_ga0209c93b14c17886aa2673320fe3d974"><div class="ttname"><a href="group__fft3dgeometry.html#ga0209c93b14c17886aa2673320fe3d974">heffte::make_slabs</a></div><div class="ttdeci">std::vector&lt; box3d&lt; index &gt; &gt; make_slabs(box3d&lt; index &gt; const world, int num_slabs, int const dimension1, int const dimension2, std::vector&lt; box3d&lt; index &gt;&gt; const &amp;source, std::array&lt; int, 3 &gt; const order, rank_remap const &amp;remap)</div><div class="ttdoc">Breaks the world into a set of slabs that span the given dimensions.</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:599</div></div>
<div class="ttc" id="agroup__fft3dgeometry_html_ga1ff6700360dd5bea7caa67d8f1ad4012"><div class="ttname"><a href="group__fft3dgeometry.html#ga1ff6700360dd5bea7caa67d8f1ad4012">heffte::is_pencils</a></div><div class="ttdeci">bool is_pencils(box3d&lt; index &gt; const world, std::vector&lt; box3d&lt; index &gt;&gt; const &amp;shape, int direction)</div><div class="ttdoc">Returns true if the shape forms pencils in the given direction.</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:442</div></div>
<div class="ttc" id="agroup__fft3dgeometry_html_ga61787c57c8ba9cf24d2bbe9a702e9a61"><div class="ttname"><a href="group__fft3dgeometry.html#ga61787c57c8ba9cf24d2bbe9a702e9a61">heffte::is_slab</a></div><div class="ttdeci">bool is_slab(box3d&lt; index &gt; const world, std::vector&lt; box3d&lt; index &gt;&gt; const &amp;shape, int direction1, int direction2)</div><div class="ttdoc">Returns true if the shape forms slabs in the given directions.</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:454</div></div>
<div class="ttc" id="agroup__fft3dgeometry_html_ga6bd726124c213a08070ad54587a08cee"><div class="ttname"><a href="group__fft3dgeometry.html#ga6bd726124c213a08070ad54587a08cee">heffte::match</a></div><div class="ttdeci">bool match(std::vector&lt; box3d&lt; index &gt;&gt; const &amp;shape0, std::vector&lt; box3d&lt; index &gt;&gt; const &amp;shape1)</div><div class="ttdoc">Compares two vectors of boxes, returns true if all boxes match.</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:246</div></div>
<div class="ttc" id="agroup__fft3dgeometry_html_ga80a897b86af45ff818a86e8cab52ee62"><div class="ttname"><a href="group__fft3dgeometry.html#ga80a897b86af45ff818a86e8cab52ee62">heffte::proc_setup_min_surface</a></div><div class="ttdeci">std::array&lt; int, 3 &gt; proc_setup_min_surface(box3d&lt; index &gt; const world, int num_procs)</div><div class="ttdoc">Creates a grid of mpi-ranks that will minimize the area of each of the boxes.</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:643</div></div>
<div class="ttc" id="agroup__fft3dgeometry_html_ga8d500c39e313762adba77fba0901dad7"><div class="ttname"><a href="group__fft3dgeometry.html#ga8d500c39e313762adba77fba0901dad7">heffte::world_complete</a></div><div class="ttdeci">bool world_complete(std::vector&lt; box3d&lt; index &gt;&gt; const &amp;boxes, box3d&lt; index &gt; const world)</div><div class="ttdoc">Returns true if the geometry of the world is as expected.</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:266</div></div>
<div class="ttc" id="agroup__fft3dgeometry_html_ga9a9004258695f15f6c9d0cffe8017a62"><div class="ttname"><a href="group__fft3dgeometry.html#ga9a9004258695f15f6c9d0cffe8017a62">heffte::maximize_overlap</a></div><div class="ttdeci">std::vector&lt; box3d&lt; index &gt; &gt; maximize_overlap(std::vector&lt; box3d&lt; index &gt;&gt; const &amp;new_boxes, std::vector&lt; box3d&lt; index &gt;&gt; const &amp;old_boxes, std::array&lt; int, 3 &gt; const order, rank_remap const &amp;remap)</div><div class="ttdoc">Shuffle the new boxes to maximize the overlap with the old boxes.</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:489</div></div>
<div class="ttc" id="agroup__fft3dgeometry_html_ga9d66a94e08af65b980ed89db972f38bd"><div class="ttname"><a href="group__fft3dgeometry.html#ga9d66a94e08af65b980ed89db972f38bd">heffte::find_world</a></div><div class="ttdeci">box3d&lt; index &gt; find_world(std::vector&lt; box3d&lt; index &gt;&gt; const &amp;boxes)</div><div class="ttdoc">Returns the box that encapsulates all other boxes.</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:229</div></div>
<div class="ttc" id="agroup__fft3dgeometry_html_gaaeffaad7ebc798b6e829789ee8c22b24"><div class="ttname"><a href="group__fft3dgeometry.html#gaaeffaad7ebc798b6e829789ee8c22b24">heffte::reorder</a></div><div class="ttdeci">std::vector&lt; box3d&lt; index &gt; &gt; reorder(std::vector&lt; box3d&lt; index &gt;&gt; const &amp;shape, std::array&lt; int, 3 &gt; order)</div><div class="ttdoc">Returns the same shape, but sets a different order for each box.</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:466</div></div>
<div class="ttc" id="agroup__fft3dgeometry_html_gab09d26871c884a0523c97d7f48d10efe"><div class="ttname"><a href="group__fft3dgeometry.html#gab09d26871c884a0523c97d7f48d10efe">heffte::split_world</a></div><div class="ttdeci">std::vector&lt; box3d&lt; index &gt; &gt; split_world(box3d&lt; index &gt; const world, std::array&lt; int, 3 &gt; const proc_grid, rank_remap const &amp;remap=rank_remap())</div><div class="ttdoc">Splits the world box into a set of boxes that will be assigned to a process in the process grid.</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:409</div></div>
<div class="ttc" id="agroup__fft3dgeometry_html_gacc239bfe5a333acdb4ca86b3b31a8fa6"><div class="ttname"><a href="group__fft3dgeometry.html#gacc239bfe5a333acdb4ca86b3b31a8fa6">heffte::make_pencils</a></div><div class="ttdeci">std::vector&lt; box3d&lt; index &gt; &gt; make_pencils(box3d&lt; index &gt; const world, std::array&lt; int, 2 &gt; const proc_grid, int const dimension, std::vector&lt; box3d&lt; index &gt;&gt; const &amp;source, std::array&lt; int, 3 &gt; const order, rank_remap const &amp;remap=rank_remap())</div><div class="ttdoc">Breaks the world into a grid of pencils and orders the pencils to the ranks that will minimize commun...</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:568</div></div>
<div class="ttc" id="agroup__fft3dgeometry_html_gae060cb9f8d719ad2007d51ca4e6ef1b0"><div class="ttname"><a href="group__fft3dgeometry.html#gae060cb9f8d719ad2007d51ca4e6ef1b0">heffte::count_connections</a></div><div class="ttdeci">long long count_connections(std::vector&lt; box3d&lt; index &gt;&gt; const &amp;new_boxes, std::vector&lt; box3d&lt; index &gt;&gt; const &amp;old_boxes)</div><div class="ttdoc">Counts the number of point-to-point connections between the old and new box geometries.</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:535</div></div>
<div class="ttc" id="agroup__fft3dmisc_html_ga2738b0dcfd330cf26181036ee5133a09"><div class="ttname"><a href="group__fft3dmisc.html#ga2738b0dcfd330cf26181036ee5133a09">heffte::direction</a></div><div class="ttdeci">direction</div><div class="ttdoc">Indicates the direction of the FFT (internal use only).</div><div class="ttdef"><b>Definition:</b> heffte_common.h:535</div></div>
<div class="ttc" id="agroup__fft3dmisc_html_ga476bab982edff617f057b5284d6ec07f"><div class="ttname"><a href="group__fft3dmisc.html#ga476bab982edff617f057b5284d6ec07f">heffte::make_procgrid</a></div><div class="ttdeci">std::array&lt; int, 2 &gt; make_procgrid(int const num_procs)</div><div class="ttdoc">Factorize the MPI ranks into a 2D grid.</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:336</div></div>
<div class="ttc" id="agroup__fft3dmisc_html_ga4b02bfa36d3805055f797a34c125e410"><div class="ttname"><a href="group__fft3dmisc.html#ga4b02bfa36d3805055f797a34c125e410">heffte::make_procgrid2d</a></div><div class="ttdeci">std::array&lt; int, 3 &gt; make_procgrid2d(box3d&lt; index &gt; const world, int direction_1d, std::array&lt; int, 2 &gt; const candidate_grid)</div><div class="ttdoc">Factorize the MPI ranks into a 2D grid with specific constraints.</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:362</div></div>
<div class="ttc" id="agroup__fft3dmisc_html_ga73973b90e6bc509951856f46e37c4bc7"><div class="ttname"><a href="group__fft3dmisc.html#ga73973b90e6bc509951856f46e37c4bc7">heffte::operator&lt;&lt;</a></div><div class="ttdeci">std::ostream &amp; operator&lt;&lt;(std::ostream &amp;os, box3d&lt; index &gt; const box)</div><div class="ttdoc">Debugging info, writes out the box to a stream.</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:146</div></div>
<div class="ttc" id="agroup__fft3dmisc_html_ga7e00c74d38b3c5aa16877e6bca80e188"><div class="ttname"><a href="group__fft3dmisc.html#ga7e00c74d38b3c5aa16877e6bca80e188">heffte::get_area</a></div><div class="ttdeci">int get_area(std::array&lt; int, 2 &gt; const &amp;dims)</div><div class="ttdoc">Get the surface area of a processor grid.</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:321</div></div>
<div class="ttc" id="agroup__hefftempi_html_ga5df7514ec8acb2b7bcc642892ed22f67"><div class="ttname"><a href="group__hefftempi.html#ga5df7514ec8acb2b7bcc642892ed22f67">heffte::mpi::comm_rank</a></div><div class="ttdeci">int comm_rank(MPI_Comm const comm)</div><div class="ttdoc">Returns the rank of this process within the specified comm.</div><div class="ttdef"><b>Definition:</b> heffte_utils.h:78</div></div>
<div class="ttc" id="agroup__hefftempi_html_ga6836d729a071bec5c6c82eff2ef17382"><div class="ttname"><a href="group__hefftempi.html#ga6836d729a071bec5c6c82eff2ef17382">heffte::mpi::comm_size</a></div><div class="ttdeci">int comm_size(MPI_Comm const comm)</div><div class="ttdoc">Returns the size of the specified communicator.</div><div class="ttdef"><b>Definition:</b> heffte_utils.h:135</div></div>
<div class="ttc" id="agroup__hefftempi_html_gacade914d344f3727d9e7d8dcfd13ed5a"><div class="ttname"><a href="group__hefftempi.html#gacade914d344f3727d9e7d8dcfd13ed5a">heffte::mpi::gather_boxes</a></div><div class="ttdeci">ioboxes&lt; index &gt; gather_boxes(box3d&lt; index &gt; const my_inbox, box3d&lt; index &gt; const my_outbox, MPI_Comm const comm)</div><div class="ttdoc">Gather all boxes across all ranks in the comm.</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:697</div></div>
<div class="ttc" id="anamespaceheffte_html"><div class="ttname"><a href="namespaceheffte.html">heffte</a></div><div class="ttdoc">Namespace containing all HeFFTe methods and classes.</div><div class="ttdef"><b>Definition:</b> heffte_backend_cuda.h:38</div></div>
<div class="ttc" id="anamespaceheffte_html_a4b817c023bc9e8c24fdb38287d777824"><div class="ttname"><a href="namespaceheffte.html#a4b817c023bc9e8c24fdb38287d777824">heffte::get_factors</a></div><div class="ttdeci">std::vector&lt; std::array&lt; int, 2 &gt; &gt; get_factors(int const n)</div><div class="ttdoc">fft3dmisc</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:301</div></div>
<div class="ttc" id="astructheffte_1_1box3d_html"><div class="ttname"><a href="structheffte_1_1box3d.html">heffte::box3d</a></div><div class="ttdoc">A generic container that describes a 3d box of indexes.</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:67</div></div>
<div class="ttc" id="astructheffte_1_1box3d_html_a1792ae4c8a043b87aa2733fb7255169a"><div class="ttname"><a href="structheffte_1_1box3d.html#a1792ae4c8a043b87aa2733fb7255169a">heffte::box3d::box3d</a></div><div class="ttdeci">box3d(std::array&lt; index, 3 &gt; clow, std::array&lt; index, 3 &gt; chigh)</div><div class="ttdoc">Constructs a box from the low and high indexes, the span in each direction includes the low and high ...</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:69</div></div>
<div class="ttc" id="astructheffte_1_1box3d_html_a1c44f9e9fa3b33de47f9d8708e01e331"><div class="ttname"><a href="structheffte_1_1box3d.html#a1c44f9e9fa3b33de47f9d8708e01e331">heffte::box3d::collide</a></div><div class="ttdeci">box3d collide(box3d const other) const</div><div class="ttdoc">Creates a box that holds the intersection of this box and the other.</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:89</div></div>
<div class="ttc" id="astructheffte_1_1box3d_html_a2b6ec65b21f44a849d3655bb2670216a"><div class="ttname"><a href="structheffte_1_1box3d.html#a2b6ec65b21f44a849d3655bb2670216a">heffte::box3d::operator!=</a></div><div class="ttdeci">bool operator!=(box3d const &amp;other) const</div><div class="ttdoc">Compares two boxes, ignoring the order, returns true if either of the box boundaries do not match.</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:111</div></div>
<div class="ttc" id="astructheffte_1_1box3d_html_a310cb34db143812c3a1b78000658ee8f"><div class="ttname"><a href="structheffte_1_1box3d.html#a310cb34db143812c3a1b78000658ee8f">heffte::box3d::operator==</a></div><div class="ttdeci">bool operator==(box3d const &amp;other) const</div><div class="ttdoc">Compares two boxes, ignoring the order, returns true if all sizes and boundaries match.</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:107</div></div>
<div class="ttc" id="astructheffte_1_1box3d_html_a386faaf6108f321eca5a334557336615"><div class="ttname"><a href="structheffte_1_1box3d.html#a386faaf6108f321eca5a334557336615">heffte::box3d::empty</a></div><div class="ttdeci">bool empty() const</div><div class="ttdoc">Returns true if the box contains no indexes.</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:84</div></div>
<div class="ttc" id="astructheffte_1_1box3d_html_a6907e43e02b4c4be3402c762581120ce"><div class="ttname"><a href="structheffte_1_1box3d.html#a6907e43e02b4c4be3402c762581120ce">heffte::box3d::is2d</a></div><div class="ttdeci">bool is2d() const</div><div class="ttdoc">Returns true if either dimension contains only a single index.</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:105</div></div>
<div class="ttc" id="astructheffte_1_1box3d_html_a6eadc38edc43ae83707d3d5e1ccfdb36"><div class="ttname"><a href="structheffte_1_1box3d.html#a6eadc38edc43ae83707d3d5e1ccfdb36">heffte::box3d::box3d</a></div><div class="ttdeci">box3d(std::array&lt; index, 3 &gt; clow, std::array&lt; index, 3 &gt; chigh, std::array&lt; int, 3 &gt; corder)</div><div class="ttdoc">Constructs a box from the low and high indexes, also sets an order.</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:73</div></div>
<div class="ttc" id="astructheffte_1_1box3d_html_a76aea01f1090189c317cfb56ef2e996c"><div class="ttname"><a href="structheffte_1_1box3d.html#a76aea01f1090189c317cfb56ef2e996c">heffte::box3d::size</a></div><div class="ttdeci">std::array&lt; index, 3 &gt; const size</div><div class="ttdoc">The number of indexes in each direction.</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:129</div></div>
<div class="ttc" id="astructheffte_1_1box3d_html_a834afa9d585eaaa047e656ca7dc5db2e"><div class="ttname"><a href="structheffte_1_1box3d.html#a834afa9d585eaaa047e656ca7dc5db2e">heffte::box3d::r2c</a></div><div class="ttdeci">box3d r2c(int dimension) const</div><div class="ttdoc">Returns the box that is reduced in the given dimension according to the real-to-complex symmetry.</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:95</div></div>
<div class="ttc" id="astructheffte_1_1box3d_html_a8bce7ff43ff4483ccfd80c372bb819a6"><div class="ttname"><a href="structheffte_1_1box3d.html#a8bce7ff43ff4483ccfd80c372bb819a6">heffte::box3d::count</a></div><div class="ttdeci">long long count() const</div><div class="ttdoc">Counts all indexes in the box, i.e., the volume.</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:86</div></div>
<div class="ttc" id="astructheffte_1_1box3d_html_aa50094796d7640f39fc1663053baef2b"><div class="ttname"><a href="structheffte_1_1box3d.html#aa50094796d7640f39fc1663053baef2b">heffte::box3d::ordered_same_as</a></div><div class="ttdeci">bool ordered_same_as(box3d const &amp;other) const</div><div class="ttdoc">Compares the order of two boxes, ignores the dimensions, returns true if the order is the same.</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:117</div></div>
<div class="ttc" id="astructheffte_1_1box3d_html_aaa4abcee136213388df9ae363e33c8c8"><div class="ttname"><a href="structheffte_1_1box3d.html#aaa4abcee136213388df9ae363e33c8c8">heffte::box3d::low</a></div><div class="ttdeci">std::array&lt; index, 3 &gt; const low</div><div class="ttdoc">The three lowest indexes.</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:125</div></div>
<div class="ttc" id="astructheffte_1_1box3d_html_aad3f4b43abbf7aeec4c4c9fd2dbe66e2"><div class="ttname"><a href="structheffte_1_1box3d.html#aad3f4b43abbf7aeec4c4c9fd2dbe66e2">heffte::box3d::box3d</a></div><div class="ttdeci">box3d(std::array&lt; index, 2 &gt; clow, std::array&lt; index, 2 &gt; chigh)</div><div class="ttdoc">Constructor for the two dimensional case.</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:77</div></div>
<div class="ttc" id="astructheffte_1_1box3d_html_ab41101a3a990a0785c3fd78a4f833f30"><div class="ttname"><a href="structheffte_1_1box3d.html#ab41101a3a990a0785c3fd78a4f833f30">heffte::box3d::find_order</a></div><div class="ttdeci">int find_order(int dir) const</div><div class="ttdoc">Returns the effective order of the direction (dir), 0 -&gt; fast, 1 -&gt; mid, 2 -&gt; slow.</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:121</div></div>
<div class="ttc" id="astructheffte_1_1box3d_html_ab86bc20cf1eaba6c4b9b2dcb63033185"><div class="ttname"><a href="structheffte_1_1box3d.html#ab86bc20cf1eaba6c4b9b2dcb63033185">heffte::box3d::high</a></div><div class="ttdeci">std::array&lt; index, 3 &gt; const high</div><div class="ttdoc">The three highest indexes.</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:127</div></div>
<div class="ttc" id="astructheffte_1_1box3d_html_abbd22d4cc74afc74d83fa67bd5ecf2d9"><div class="ttname"><a href="structheffte_1_1box3d.html#abbd22d4cc74afc74d83fa67bd5ecf2d9">heffte::box3d::box3d</a></div><div class="ttdeci">box3d(std::array&lt; index, 2 &gt; clow, std::array&lt; index, 2 &gt; chigh, std::array&lt; int, 2 &gt; corder)</div><div class="ttdoc">Constructor for the two dimensional case, order is either (0, 1) or (1, 0).</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:80</div></div>
<div class="ttc" id="astructheffte_1_1box3d_html_ad5476621fa6cd5053bfe7b33a864f34d"><div class="ttname"><a href="structheffte_1_1box3d.html#ad5476621fa6cd5053bfe7b33a864f34d">heffte::box3d::order</a></div><div class="ttdeci">std::array&lt; int, 3 &gt; const order</div><div class="ttdoc">The order of the dimensions in the k * plane_stride + j * line_stride + i indexing.</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:131</div></div>
<div class="ttc" id="astructheffte_1_1box3d_html_af511df6e2d8e03afc2f79e0548acef4b"><div class="ttname"><a href="structheffte_1_1box3d.html#af511df6e2d8e03afc2f79e0548acef4b">heffte::box3d::osize</a></div><div class="ttdeci">index osize(int dimension) const</div><div class="ttdoc">Get the ordered size of the dimension, i.e., size[order[dimension]].</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:123</div></div>
<div class="ttc" id="astructheffte_1_1ioboxes_html"><div class="ttname"><a href="structheffte_1_1ioboxes.html">heffte::ioboxes</a></div><div class="ttdoc">Pair of lists of input-output boxes as used by the heffte::fft3d.</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:213</div></div>
<div class="ttc" id="astructheffte_1_1ioboxes_html_a8a3ae817182181f2506a94127346c8d0"><div class="ttname"><a href="structheffte_1_1ioboxes.html#a8a3ae817182181f2506a94127346c8d0">heffte::ioboxes::in</a></div><div class="ttdeci">std::vector&lt; box3d&lt; index &gt; &gt; in</div><div class="ttdoc">Inboxes for all ranks across the comm.</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:215</div></div>
<div class="ttc" id="astructheffte_1_1ioboxes_html_ab864204811ea50a1f2e52020e0b46345"><div class="ttname"><a href="structheffte_1_1ioboxes.html#ab864204811ea50a1f2e52020e0b46345">heffte::ioboxes::out</a></div><div class="ttdeci">std::vector&lt; box3d&lt; index &gt; &gt; out</div><div class="ttdoc">Outboxes for all ranks across the comm.</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:217</div></div>
<div class="ttc" id="astructheffte_1_1rank__remap_html"><div class="ttname"><a href="structheffte_1_1rank__remap.html">heffte::rank_remap</a></div><div class="ttdoc">Keeps the local rank and the map from the global rank to the sub-ranks used in the work.</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:179</div></div>
<div class="ttc" id="astructheffte_1_1rank__remap_html_a01a369b104bb599b62cf429b100abed4"><div class="ttname"><a href="structheffte_1_1rank__remap.html#a01a369b104bb599b62cf429b100abed4">heffte::rank_remap::mpi_rank</a></div><div class="ttdeci">int const mpi_rank</div><div class="ttdoc">The local rank.</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:185</div></div>
<div class="ttc" id="astructheffte_1_1rank__remap_html_a1c9f9e10d2198323088632123ac63ecd"><div class="ttname"><a href="structheffte_1_1rank__remap.html#a1c9f9e10d2198323088632123ac63ecd">heffte::rank_remap::set_subranks</a></div><div class="ttdeci">void set_subranks(size_t all_ranks, int sub_ranks)</div><div class="ttdoc">Build the map when using fixed number of sub-ranks.</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:189</div></div>
<div class="ttc" id="astructheffte_1_1rank__remap_html_a6ec81f64ae07e6b34debb2283446c723"><div class="ttname"><a href="structheffte_1_1rank__remap.html#a6ec81f64ae07e6b34debb2283446c723">heffte::rank_remap::set_subranks</a></div><div class="ttdeci">void set_subranks(MPI_Comm global, MPI_Comm subcomm)</div><div class="ttdoc">Build the map when using user provided sub-communicator.</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:195</div></div>
<div class="ttc" id="astructheffte_1_1rank__remap_html_a7fb8c0864d86f17860e784b568df09db"><div class="ttname"><a href="structheffte_1_1rank__remap.html#a7fb8c0864d86f17860e784b568df09db">heffte::rank_remap::empty</a></div><div class="ttdeci">bool empty() const</div><div class="ttdoc">Indicates whether the remap is empty.</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:203</div></div>
<div class="ttc" id="astructheffte_1_1rank__remap_html_aa2bc6113d63e6eff377100dcb199c0bc"><div class="ttname"><a href="structheffte_1_1rank__remap.html#aa2bc6113d63e6eff377100dcb199c0bc">heffte::rank_remap::size_subcomm</a></div><div class="ttdeci">int size_subcomm</div><div class="ttdoc">The number of ranks in the sub-comm.</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:201</div></div>
<div class="ttc" id="astructheffte_1_1rank__remap_html_ac3ddc0df8798b859555b71635baa65f9"><div class="ttname"><a href="structheffte_1_1rank__remap.html#ac3ddc0df8798b859555b71635baa65f9">heffte::rank_remap::rank_remap</a></div><div class="ttdeci">rank_remap(int rank)</div><div class="ttdoc">Creates a new remap and initializes only the mpi_rank.</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:183</div></div>
<div class="ttc" id="astructheffte_1_1rank__remap_html_ac98db942ac17288ad687e36c480ea6a9"><div class="ttname"><a href="structheffte_1_1rank__remap.html#ac98db942ac17288ad687e36c480ea6a9">heffte::rank_remap::map</a></div><div class="ttdeci">std::vector&lt; int &gt; map</div><div class="ttdoc">Global to local map.</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:187</div></div>
<div class="ttc" id="astructheffte_1_1rank__remap_html_ae76ef0915e569e14db0a3dc434ee4880"><div class="ttname"><a href="structheffte_1_1rank__remap.html#ae76ef0915e569e14db0a3dc434ee4880">heffte::rank_remap::rank_remap</a></div><div class="ttdeci">rank_remap()</div><div class="ttdoc">Default constructor.</div><div class="ttdef"><b>Definition:</b> heffte_geometry.h:181</div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><b>heffte_geometry.h</b></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
