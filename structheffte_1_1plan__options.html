<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Highly Efficient FFT for Exascale: HeFFTe v2.3: heffte::plan_options Struct Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="heffte.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Highly Efficient FFT for Exascale: HeFFTe v2.3
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('structheffte_1_1plan__options.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="structheffte_1_1plan__options-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">heffte::plan_options Struct Reference<div class="ingroups"><a class="el" href="group__fft3d.html">Fast Fourier Transform</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>Defines a set of tweaks and options to use in the plan generation.  
 <a href="structheffte_1_1plan__options.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="heffte__plan__logic_8h_source.html">heffte_plan_logic.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a030deb7d02b8078273fcef3aec61cf81"><td class="memTemplParams" colspan="2"><a id="a030deb7d02b8078273fcef3aec61cf81"></a>
template&lt;typename backend_tag &gt; </td></tr>
<tr class="memitem:a030deb7d02b8078273fcef3aec61cf81"><td class="memTemplItemLeft" align="right" valign="top">&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="structheffte_1_1plan__options.html#a030deb7d02b8078273fcef3aec61cf81">plan_options</a> (backend_tag const)</td></tr>
<tr class="memdesc:a030deb7d02b8078273fcef3aec61cf81"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor, initializes all options with the default values for the given backend tag. <br /></td></tr>
<tr class="separator:a030deb7d02b8078273fcef3aec61cf81"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acdf2036279a21275cae569089691e15d"><td class="memItemLeft" align="right" valign="top"><a id="acdf2036279a21275cae569089691e15d"></a>
&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structheffte_1_1plan__options.html#acdf2036279a21275cae569089691e15d">plan_options</a> (bool <a class="el" href="group__fft3dgeometry.html#gaaeffaad7ebc798b6e829789ee8c22b24">reorder</a>, <a class="el" href="group__fft3d.html#ga4c9d07a6600d0e32939ec064c0604767">reshape_algorithm</a> alg, bool pencils)</td></tr>
<tr class="memdesc:acdf2036279a21275cae569089691e15d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor, initializes each variable, primarily for internal use. <br /></td></tr>
<tr class="separator:acdf2036279a21275cae569089691e15d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a180cca2f2146900df58aef7ff5775941"><td class="memItemLeft" align="right" valign="top"><a id="a180cca2f2146900df58aef7ff5775941"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structheffte_1_1plan__options.html#a180cca2f2146900df58aef7ff5775941">use_num_subranks</a> (int num_subranks)</td></tr>
<tr class="memdesc:a180cca2f2146900df58aef7ff5775941"><td class="mdescLeft">&#160;</td><td class="mdescRight">Defines the number of ranks to use for the internal reshapes, set to -1 to use all ranks. <br /></td></tr>
<tr class="separator:a180cca2f2146900df58aef7ff5775941"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9448c6b2579007d19339644c41666df0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structheffte_1_1plan__options.html#a9448c6b2579007d19339644c41666df0">use_subcomm</a> (MPI_Comm comm)</td></tr>
<tr class="memdesc:a9448c6b2579007d19339644c41666df0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set sub-communicator to use in the intermediate reshape operations.  <a href="structheffte_1_1plan__options.html#a9448c6b2579007d19339644c41666df0">More...</a><br /></td></tr>
<tr class="separator:a9448c6b2579007d19339644c41666df0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a03bd60a8d3462d54ea072775746702c5"><td class="memItemLeft" align="right" valign="top"><a id="a03bd60a8d3462d54ea072775746702c5"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structheffte_1_1plan__options.html#a03bd60a8d3462d54ea072775746702c5">get_subranks</a> () const</td></tr>
<tr class="memdesc:a03bd60a8d3462d54ea072775746702c5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the set number of sub-ranks. <br /></td></tr>
<tr class="separator:a03bd60a8d3462d54ea072775746702c5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:a62bf760501d96b597122df2175e76add"><td class="memItemLeft" align="right" valign="top"><a id="a62bf760501d96b597122df2175e76add"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structheffte_1_1plan__options.html#a62bf760501d96b597122df2175e76add">use_reorder</a></td></tr>
<tr class="memdesc:a62bf760501d96b597122df2175e76add"><td class="mdescLeft">&#160;</td><td class="mdescRight">Defines whether to transpose the data on reshape or to use strided 1-D ffts. <br /></td></tr>
<tr class="separator:a62bf760501d96b597122df2175e76add"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a347a09b1a9f9c2397588f7c550521ab8"><td class="memItemLeft" align="right" valign="top"><a id="a347a09b1a9f9c2397588f7c550521ab8"></a>
<a class="el" href="group__fft3d.html#ga4c9d07a6600d0e32939ec064c0604767">reshape_algorithm</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structheffte_1_1plan__options.html#a347a09b1a9f9c2397588f7c550521ab8">algorithm</a></td></tr>
<tr class="memdesc:a347a09b1a9f9c2397588f7c550521ab8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Defines the communication algorithm. <br /></td></tr>
<tr class="separator:a347a09b1a9f9c2397588f7c550521ab8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad01d66e416b57465b5162f1503cb79a0"><td class="memItemLeft" align="right" valign="top"><a id="ad01d66e416b57465b5162f1503cb79a0"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structheffte_1_1plan__options.html#ad01d66e416b57465b5162f1503cb79a0">use_pencils</a></td></tr>
<tr class="memdesc:ad01d66e416b57465b5162f1503cb79a0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Defines whether to use pencil or slab data distribution in the reshape steps. <br /></td></tr>
<tr class="separator:ad01d66e416b57465b5162f1503cb79a0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6ce33ffd444e585458296999f9562585"><td class="memItemLeft" align="right" valign="top"><a id="a6ce33ffd444e585458296999f9562585"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structheffte_1_1plan__options.html#a6ce33ffd444e585458296999f9562585">use_gpu_aware</a></td></tr>
<tr class="memdesc:a6ce33ffd444e585458296999f9562585"><td class="mdescLeft">&#160;</td><td class="mdescRight">Defines whether to use MPI calls directly from the GPU or to move to the CPU first. <br /></td></tr>
<tr class="separator:a6ce33ffd444e585458296999f9562585"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Defines a set of tweaks and options to use in the plan generation. </p>
<p>Example usage: </p><div class="fragment"><div class="line"><a class="code" href="structheffte_1_1plan__options.html">heffte::plan_options</a> options = heffte::default_options&lt;heffte::backend::fftw&gt;();</div>
<div class="line">options.<a class="code" href="structheffte_1_1plan__options.html#a347a09b1a9f9c2397588f7c550521ab8">algorithm</a> = <a class="code" href="group__fft3d.html#gga4c9d07a6600d0e32939ec064c0604767a705bcf0e77bc8b6fc8e66cbf3c055e6c">reshape_algorithm::p2p</a>; <span class="comment">// forces the use of point-to-point communication</span></div>
<div class="line"><a class="code" href="classheffte_1_1fft3d.html">heffte::fft3d&lt;heffte::backend::fftw&gt;</a> fft3d(inbox, outbox, comm, options);</div>
<div class="ttc" id="aclassheffte_1_1fft3d_html"><div class="ttname"><a href="classheffte_1_1fft3d.html">heffte::fft3d</a></div><div class="ttdoc">Defines the plan for a 3-dimensional discrete Fourier transform performed on a MPI distributed data.</div><div class="ttdef"><b>Definition:</b> heffte_fft3d.h:213</div></div>
<div class="ttc" id="agroup__fft3d_html_gga4c9d07a6600d0e32939ec064c0604767a705bcf0e77bc8b6fc8e66cbf3c055e6c"><div class="ttname"><a href="group__fft3d.html#gga4c9d07a6600d0e32939ec064c0604767a705bcf0e77bc8b6fc8e66cbf3c055e6c">heffte::reshape_algorithm::p2p</a></div><div class="ttdeci">@ p2p</div><div class="ttdoc">Using MPI_Send and MPI_Irecv, receive is pipelined with packing and sending.</div></div>
<div class="ttc" id="astructheffte_1_1plan__options_html"><div class="ttname"><a href="structheffte_1_1plan__options.html">heffte::plan_options</a></div><div class="ttdoc">Defines a set of tweaks and options to use in the plan generation.</div><div class="ttdef"><b>Definition:</b> heffte_plan_logic.h:131</div></div>
<div class="ttc" id="astructheffte_1_1plan__options_html_a347a09b1a9f9c2397588f7c550521ab8"><div class="ttname"><a href="structheffte_1_1plan__options.html#a347a09b1a9f9c2397588f7c550521ab8">heffte::plan_options::algorithm</a></div><div class="ttdeci">reshape_algorithm algorithm</div><div class="ttdoc">Defines the communication algorithm.</div><div class="ttdef"><b>Definition:</b> heffte_plan_logic.h:148</div></div>
</div><!-- fragment --><dl class="section user"><dt>Option use_reorder</dt><dd>Controls whether the backends should be called with strided or contiguous data. If the option is enabled then during the reshape operations heFFTe will reorder the data so that the backend is called for contiguous batch of 1D FFTs. Otherwise the strided call will be performed. Depending on the size and the specific backend (or version of the backend), one or the other may improve performance. The reorder is applied during the unpacking stage of an MPI communication and will be applied even if no MPI communication is used. Note that some backends don't currently support strided transforms, e.g., the Sine and Cosine transforms, in which case this option will have no effect.</dd></dl>
<dl class="section user"><dt>Option algorithm</dt><dd>Specifies the combination of MPI calls to use in the communication. See <code><a class="el" href="group__fft3d.html#ga4c9d07a6600d0e32939ec064c0604767" title="Defines list of potential communication algorithms.">heffte::reshape_algorithm</a></code> for details.</dd></dl>
<dl class="section user"><dt>Option use_pencils</dt><dd>Indicates whether the intermediate steps of the computation should be done either in pencil or slab format. Slabs work better for problems with fewer MPI ranks, while pencils work better when the number ranks increases. The specific cutoff depends on the hardware and MPI implementation. Note that is the input or output shape of the data is in slab format, then this option will be ignored.</dd></dl>
<dl class="section user"><dt>Option use_gpu_aware</dt><dd>Applied only when using one of the GPU backends, indicates whether MPI communication should be initiated from the GPU device or if the data has to be moved the CPU first. MPI calls from the GPU have faster throughput but larger latency, thus initiating the calls from the CPU (e.g., setting use_gpu_aware to false) can be faster when using smaller problems compared to the number of MPI ranks.</dd></dl>
<dl class="section user"><dt>Option use_subcomm or use_num_subranks</dt><dd>Restricts the intermediate reshape and FFT operations to a subset of the ranks specified by the communicator given in the construction of <a class="el" href="classheffte_1_1fft3d.html" title="Defines the plan for a 3-dimensional discrete Fourier transform performed on a MPI distributed data.">heffte::fft3d</a> and <a class="el" href="classheffte_1_1fft3d__r2c.html" title="Similar to heffte::fft3d, but computed fewer redundant coefficients when the input is real.">heffte::fft3d_r2c</a>. By default, heFFTe will use all of the available MPI ranks but this is not always optimal (see the two examples below). The other options are defined as member variables, but the subcomm option is specified with member functions that accept either an integer or an MPI communicator. Using an integer will specify ranks <b>0</b> to <b>num_subranks</b> -1, while using a communicator can define an arbitrary subset. MPI ranks that don't belong to the subcomm should pass MPI_COMM_NULL. The <a class="el" href="structheffte_1_1plan__options.html" title="Defines a set of tweaks and options to use in the plan generation.">plan_options</a> class will hold a non-owning reference to the MPI subcomm but <a class="el" href="classheffte_1_1fft3d.html" title="Defines the plan for a 3-dimensional discrete Fourier transform performed on a MPI distributed data.">heffte::fft3d</a> and <a class="el" href="classheffte_1_1fft3d__r2c.html" title="Similar to heffte::fft3d, but computed fewer redundant coefficients when the input is real.">heffte::fft3d_r2c</a> will use the subcomm only in the constructors, i.e., the subcomm can be safely discarded/freed after the <a class="el" href="classheffte_1_1fft3d.html" title="Defines the plan for a 3-dimensional discrete Fourier transform performed on a MPI distributed data.">fft3d</a> classes are constructed.</dd></dl>
<dl class="section user"><dt></dt><dd>For example, if the input and output shapes of the data do not form pencils in any direction (i.e., using a brick decomposition), then heFFTe has to perform 4 reshape operations (3 if using slabs) and if the problem size is small relative to the number of ranks this results in 4 sets of small messages which increases the latency and reduces performance. However, if the problem can fit on a single node (e.g., single GPU), then gathering all the data to a single rank then performing a single 3D FFT and scattering the data back will result in only 2 communications involving the small messages. Thus, so long as the two operations are less expensive than the 4, using a subcomm will result in an overall performance boost.</dd></dl>
<dl class="section user"><dt></dt><dd>Similar to the previous example, if we are using a CPU backend with multiple MPI ranks per node, then reducing the MPI ranks to one-per-node can effectively coalesce smaller messages from multiple ranks to larger messages and thus reduce latency. If the CPU backend supports multi-threading, then all CPU cores can still be used by calls from the single rank without reduction of performance. </dd></dl>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a id="a9448c6b2579007d19339644c41666df0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9448c6b2579007d19339644c41666df0">&#9670;&nbsp;</a></span>use_subcomm()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void heffte::plan_options::use_subcomm </td>
          <td>(</td>
          <td class="paramtype">MPI_Comm&#160;</td>
          <td class="paramname"><em>comm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Set sub-communicator to use in the intermediate reshape operations. </p>
<p>The ranks defined by <b>comm</b> must be a subset of the communicator that will be used in the future call to <a class="el" href="classheffte_1_1fft3d.html" title="Defines the plan for a 3-dimensional discrete Fourier transform performed on a MPI distributed data.">heffte::fft3d</a> or <a class="el" href="classheffte_1_1fft3d__r2c.html" title="Similar to heffte::fft3d, but computed fewer redundant coefficients when the input is real.">heffte::fft3d_r2c</a>. The ranks that are not associated with the comm should pass in MPI_COMM_NULL. The <a class="el" href="structheffte_1_1plan__options.html" title="Defines a set of tweaks and options to use in the plan generation.">plan_options</a> object will take a non-owning reference to <b>comm</b> but the reference will not be passed into <a class="el" href="classheffte_1_1fft3d.html" title="Defines the plan for a 3-dimensional discrete Fourier transform performed on a MPI distributed data.">heffte::fft3d</a> or <a class="el" href="classheffte_1_1fft3d__r2c.html" title="Similar to heffte::fft3d, but computed fewer redundant coefficients when the input is real.">heffte::fft3d_r2c</a>.</p>
<p>This method takes precedence over <a class="el" href="structheffte_1_1plan__options.html#a180cca2f2146900df58aef7ff5775941" title="Defines the number of ranks to use for the internal reshapes, set to -1 to use all ranks.">use_num_subranks()</a> if both methods are called. Avoid calling both methods. </p>

</div>
</div>
<hr/>The documentation for this struct was generated from the following file:<ul>
<li>include/<a class="el" href="heffte__plan__logic_8h_source.html">heffte_plan_logic.h</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespaceheffte.html">heffte</a></li><li class="navelem"><a class="el" href="structheffte_1_1plan__options.html">plan_options</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
